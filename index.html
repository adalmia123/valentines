<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Caveat:wght@400;700&family=Indie+Flower&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #ffe6ea;
            --env-color: #ff5c8a;      
            --env-dark: #d6336c;       
            --env-inside: #880e4f;     
            --paper-color: #fffbf0;    
            --paper-line: #e6d2b5;     
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            overflow: hidden; 
        }

        /* --- ENVELOPE CONTAINER --- */
        .container {
            position: relative;
            width: 400px;
            height: 260px;
            cursor: pointer;
            z-index: 10;
        }

        .container:hover { transform: scale(1.02); transition: transform 0.3s; }

        .envelope {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* 1. BACK (Dark Inside) */
        .back {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: var(--env-inside);
            border-radius: 0 0 10px 10px;
            z-index: 1;
        }

        /* 2. THE LETTER */
        .letter {
            position: absolute;
            bottom: 0; 
            left: 5%;
            width: 90%;
            height: 90%;
            background: var(--paper-color);
            border: 1px solid var(--paper-line);
            
            /* Initial State: Inside Pocket */
            z-index: 2; 
            transition: transform 0.6s ease-in-out, top 0.6s, left 0.6s, width 0.6s, height 0.6s, box-shadow 0.6s;
            
            padding: 30px; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        /* 3. FRONT POCKET */
        .pocket {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 3; 
            pointer-events: none; 
        }

        .flap { position: absolute; }

        .flap.left {
            top: 0; left: 0;
            border-top: 130px solid transparent;
            border-bottom: 130px solid transparent;
            border-left: 220px solid var(--env-color);
        }
        
        .flap.right {
            top: 0; right: 0;
            border-top: 130px solid transparent;
            border-bottom: 130px solid transparent;
            border-right: 220px solid var(--env-color);
        }

        .flap.bottom {
            bottom: 0; left: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-bottom: 150px solid var(--env-dark); 
            border-radius: 0 0 10px 10px;
        }

        /* 4. LID */
        .lid {
            position: absolute;
            top: 0; left: 0;
            width: 0; height: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-top: 140px solid var(--env-color); 
            transform-origin: top;
            transition: transform 0.6s ease-in-out;
            z-index: 4; 
        }

        /* --- LETTER CONTENT --- */
        .letter h2 {
            font-family: 'Dancing Script', cursive;
            color: #d32f2f;
            font-size: 2.5rem;
            margin: 5px 0 15px 0;
        }
        
        .letter p {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            color: #444;
            margin: 5px 0;
            line-height: 1.2;
        }

        /* Hide buttons/text initially to prevent peeking */
        .letter-content {
            opacity: 0;
            transition: opacity 0.5s ease 0.5s;
        }

        /* --- ANIMATION STATES --- */
        
        /* Step 1: Flip Lid */
        .open .lid {
            transform: rotateX(180deg);
            z-index: 0; 
        }

        /* Step 2: Extract Letter (Slide Up) */
        .open .letter {
            transform: translateY(-220px); 
            z-index: 5; 
        }

        /* Step 3: Present Letter (Center & Expand) - Applied via JS */
        .letter.full-mode {
            position: fixed; /* Break out of envelope */
            top: 50%; 
            left: 50%;
            /* Center and Scale Up */
            transform: translate(-50%, -50%) scale(1.2) !important; 
            width: 400px;
            height: 500px;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border-radius: 10px;
        }

        .letter.full-mode .letter-content {
            opacity: 1; /* Show text only when centered */
        }

        /* --- BUTTONS --- */
        .btn-group {
            margin-top: 40px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        button {
            padding: 12px 35px;
            font-family: 'Poppins', sans-serif;
            font-weight: bold;
            font-size: 16px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease; 
        }

        #yesBtn { background-color: #ff4d6d; color: white; }
        
        #noBtn { 
            background-color: #e0e0e0; 
            color: #333; 
            position: relative; 
            transition: top 0.4s ease, left 0.4s ease; 
        }

        #yesBtn:hover { transform: scale(1.1); }

        /* --- CELEBRATION PAGE --- */
        #celebration {
            display: none;
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0; left: 0;
            background-color: var(--bg-color);
            z-index: 100;
            overflow-y: auto;
            text-align: center;
            padding-top: 50px;
        }

        #celebration h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem;
            color: #c92a42;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px white;
            position: relative;
            z-index: 10;
        }

        /* CANVAS FOR FLOWERS */
        #garden {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; 
            pointer-events: none;
        }

        /* NOTES GRID */
        .reasons-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 1000px;
            margin: 40px auto;
            padding-bottom: 100px;
            position: relative;
            z-index: 5;
        }

        .sticky-note {
            width: 180px;
            height: 180px;
            padding: 20px;
            font-family: 'Indie Flower', cursive;
            font-size: 1.2rem;
            color: #444;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transform: rotate(var(--rot));
            background: rgba(255, 255, 255, 0.95);
        }
        
        .sticky-note:hover { transform: scale(1.1) rotate(0deg) !important; z-index: 100; }

        /* --- CSS HEARTS --- */
        .css-heart {
            position: absolute;
            width: 30px;
            height: 30px;
            transform: rotate(-45deg);
            pointer-events: none;
            z-index: 20;
            opacity: 0; 
        }
        .css-heart::before, .css-heart::after {
            content: ""; position: absolute; width: 30px; height: 30px;
            border-radius: 50%; background-color: inherit; 
        }
        .css-heart::before { top: -15px; left: 0; }
        .css-heart::after { left: 15px; top: 0; }

        @keyframes floatUp { 
            0% { transform: translateY(0) rotate(-45deg) scale(0.5); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-400px) rotate(-45deg) scale(1.2); opacity: 0; }
        }
        @keyframes rainDown { 
            0% { transform: translateY(-10vh) rotate(-45deg) translateX(0); opacity: 1; }
            50% { transform: translateY(50vh) rotate(-35deg) translateX(20px); }
            100% { transform: translateY(110vh) rotate(-45deg) translateX(-20px); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="container" id="container" onclick="openEnvelope()">
        <div class="envelope">
            <div class="back"></div>
            
            <div class="letter" id="letter">
                <div class="letter-content">
                    <h2>My Dearest,</h2>
                    <p>I have a question...</p>
                    <p><strong>Will you be my Valentine?</strong></p>
                    <p style="font-size: 0.9rem; margin-top: 15px; color: #888;">(I promise to buy you flowers!)</p>
                    <div class="btn-group">
                        <button id="yesBtn" onclick="celebrate(event)">YES!</button>
                        <button id="noBtn" onmouseover="runAway(event)">No</button>
                    </div>
                </div>
            </div>

            <div class="pocket">
                <div class="flap left"></div>
                <div class="flap right"></div>
                <div class="flap bottom"></div>
            </div>
            
            <div class="lid"></div>
        </div>
    </div>

    <div id="celebration">
        <h1>YAY! I Love You! ❤️</h1>
        <canvas id="garden"></canvas>
        <div style="height: 50px;"></div>
        <h2 style="font-family: 'Poppins'; color: #555; background: rgba(255,255,255,0.7); display:inline-block; padding: 5px 15px; border-radius: 10px; position: relative; z-index: 5;">100 Reasons Why:</h2>
        <div class="reasons-grid" id="reasonsGrid"></div>
    </div>

    <script>
        let isOpen = false;
        let canRunaway = false; 
        const container = document.getElementById('container');
        const letter = document.getElementById('letter');
        const noBtn = document.getElementById('noBtn');

        // 1. OPEN ENVELOPE LOGIC
        function openEnvelope() {
            if (!isOpen) {
                container.classList.add('open');
                isOpen = true;
                
                // Spawn Opening Hearts
                for(let i=0; i<15; i++){ setTimeout(() => spawnHeart(true), i * 150); }

                // STAGE 2: After letter slides out (0.6s), Center it
                setTimeout(() => {
                    letter.classList.add('full-mode');
                    canRunaway = true; // Enable buttons now
                }, 800);
            }
        }

        // 2. RUNAWAY NO BUTTON
        function runAway(e) {
            e.stopPropagation();
            if (!canRunaway) return;
            
            const btnW = noBtn.offsetWidth;
            const btnH = noBtn.offsetHeight;
            const maxX = window.innerWidth - btnW - 20;
            const maxY = window.innerHeight - btnH - 20;
            
            const newX = Math.random() * maxX;
            const newY = Math.random() * maxY;

            noBtn.style.position = 'fixed';
            noBtn.style.left = Math.max(10, newX) + 'px'; 
            noBtn.style.top = Math.max(10, newY) + 'px'; 
            noBtn.style.zIndex = '1000';
            
            // Grow Yes Button
            const yesBtn = document.getElementById('yesBtn');
            let currentSize = parseFloat(window.getComputedStyle(yesBtn).fontSize);
            yesBtn.style.fontSize = (currentSize + 2) + 'px';
            yesBtn.style.padding = '15px 40px';
        }

        // 3. CELEBRATION
        function celebrate(e) {
            e.stopPropagation();
            document.body.style.backgroundColor = "#fce4ec"; 
            container.style.display = 'none';
            letter.style.display = 'none'; // Hide the fixed letter
            
            const celeb = document.getElementById('celebration');
            celeb.style.display = 'block';
            
            generateReasons();
            setTimeout(initGarden, 100);
            setInterval(() => spawnHeart(false), 400); 
        }

        // 4. DATA GENERATION
        const myReasons = [
            "Your kindness", "The way you smell", "Your cooking", "Your ambition",
            "Our late night talks", "Your eyes", "How you support me", "Your hugs",
            "Inside jokes", "Your patience", "Your intelligence", "Your style",
            "Your laugh", "The way you dance", "Your voice"
        ];
        while (myReasons.length < 100) { myReasons.push("Reason #" + (myReasons.length + 1) + ": I love you!"); }
        
        // PASTEL COLORS
        const noteColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#FDFD96', '#FFFACD', '#C3B1E1', '#DCD0FF'];

        function generateReasons() {
            const grid = document.getElementById('reasonsGrid');
            myReasons.forEach((reason) => {
                const note = document.createElement('div');
                note.classList.add('sticky-note');
                note.innerText = reason;
                note.style.setProperty('--rot', (Math.random() * 10 - 5) + 'deg');
                note.style.backgroundColor = noteColors[Math.floor(Math.random() * noteColors.length)];
                grid.appendChild(note);
            });
        }

        // 5. HEART SPAWNER
        const heartColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#C3B1E1', '#DCD0FF'];
        function spawnHeart(isBalloon) {
            const heart = document.createElement('div');
            heart.classList.add('css-heart');
            heart.style.backgroundColor = heartColors[Math.floor(Math.random() * heartColors.length)];

            if (isBalloon) {
                container.appendChild(heart);
                heart.style.left = (Math.random() * 60 + 20) + '%';
                heart.style.top = '50%'; 
                heart.style.animationName = 'floatUp';
                heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
            } else {
                document.body.appendChild(heart);
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = '-10vh'; 
                heart.style.position = 'fixed';
                heart.style.animationName = 'rainDown';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
            }
            setTimeout(() => heart.remove(), 6000);
        }

        // ==========================================
        //  COMPLEX PROCEDURAL FLOWER ENGINE
        // ==========================================
        function initGarden() {
            const canvas = document.getElementById('garden');
            const ctx = canvas.getContext('2d');
            
            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resize();
            window.addEventListener('resize', resize);

            const flowers = [];

            function drawComplexPetal(x, y, w, h, color, angle, noise = 0) {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle);
                ctx.beginPath();
                
                if (noise > 0) {
                    ctx.moveTo(0, 0);
                    for(let i=0; i<=h; i+=5) {
                        let offset = Math.sin(i * 0.5) * noise;
                        let petalWidthAtY = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(-petalWidthAtY/2 + offset, -i);
                    }
                    for(let i=h; i>=0; i-=5) {
                        let offset = Math.sin(i * 0.5) * noise;
                        let petalWidthAtY = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(petalWidthAtY/2 + offset, -i);
                    }
                } else {
                    ctx.moveTo(0, 0);
                    ctx.bezierCurveTo(-w, -h/2, -w/2, -h, 0, -h); 
                    ctx.bezierCurveTo(w/2, -h, w, -h/2, 0, 0);    
                }
                
                let grad = ctx.createLinearGradient(0, 0, 0, -h);
                grad.addColorStop(0, darken(color, 20));
                grad.addColorStop(1, color);
                
                ctx.fillStyle = grad;
                ctx.fill();
                ctx.restore();
            }

            class Flower {
                constructor(x, y, type, colorHex) {
                    this.x = x; this.y = y; this.originalY = y;
                    this.height = 0; 
                    this.maxHeight = Math.random() * 150 + 200;
                    this.growSpeed = Math.random() * 2 + 1;
                    this.type = type; 
                    this.colorHex = colorHex;
                    this.bloomed = false; 
                    this.bloomSize = 0; 
                    this.maxBloom = Math.random() * 0.8 + 0.4;
                }

                draw() {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.originalY);
                    const curve = Math.sin(this.height * 0.05) * 5;
                    ctx.quadraticCurveTo(this.x + curve, this.originalY - this.height / 2, this.x, this.originalY - this.height);
                    ctx.strokeStyle = '#2d6a4f'; ctx.lineWidth = 4; ctx.stroke();

                    if(this.height > 60) { drawComplexPetal(this.x, this.originalY - 50, 20, 15, '#40916c', -1.5, 0); }
                    if(this.height > 100) { drawComplexPetal(this.x, this.originalY - 90, 20, 15, '#40916c', 1.5, 0); }

                    if (this.bloomed) {
                        const headX = this.x; const headY = this.originalY - this.height; const s = this.bloomSize * 30;

                        if (this.type === 'rose') {
                            for(let i=0; i<8; i++) { drawComplexPetal(headX, headY, s, s, this.colorHex, (i * (Math.PI*2)/8), 0); }
                            for(let i=0; i<6; i++) { drawComplexPetal(headX, headY, s*0.7, s*0.8, darken(this.colorHex, 10), (i * (Math.PI*2)/6) + 0.5, 0); }
                            for(let i=0; i<5; i++) { drawComplexPetal(headX, headY, s*0.4, s*0.5, darken(this.colorHex, 20), (i * (Math.PI*2)/5), 0); }
                        } else if (this.type === 'carnation') {
                            for(let i=0; i<12; i++) { drawComplexPetal(headX, headY, s*0.8, s*1.2, this.colorHex, (i * (Math.PI*2)/12), 4); }
                            for(let i=0; i<8; i++) { drawComplexPetal(headX, headY, s*0.6, s*0.9, lighten(this.colorHex, 10), (i * (Math.PI*2)/8) + 0.2, 4); }
                        } else if (this.type === 'tulip') {
                            drawComplexPetal(headX, headY, s, s*1.5, darken(this.colorHex, 10), -0.3, 0);
                            drawComplexPetal(headX, headY, s, s*1.5, darken(this.colorHex, 10), 0.3, 0);
                            drawComplexPetal(headX, headY, s*1.2, s*1.6, this.colorHex, 0, 0);
                        }
                    }
                }

                update() {
                    if (this.height < this.maxHeight) { this.height += this.growSpeed; } else { this.bloomed = true; }
                    if (this.bloomed && this.bloomSize < this.maxBloom) { this.bloomSize += 0.01; }
                    this.draw();
                }
            }

            function darken(col, amt) {
                let num = parseInt(col.slice(1), 16);
                let r = (num >> 16) - amt; let g = ((num >> 8) & 0x00FF) - amt; let b = (num & 0x0000FF) - amt;
                if(r<0) r=0; if(g<0) g=0; if(b<0) b=0;
                return "#" + (g | (b << 8) | (r << 16)).toString(16).padStart(6,0);
            }
            function lighten(col, amt) {
                let num = parseInt(col.slice(1), 16);
                let r = (num >> 16) + amt; let g = ((num >> 8) & 0x00FF) + amt; let b = (num & 0x0000FF) + amt;
                if(r>255) r=255; if(g>255) g=255; if(b>255) b=255;
                return "#" + (g | (b << 8) | (r << 16)).toString(16).padStart(6,0);
            }

            // PASTEL COLORS
            const colors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#FDFD96', '#FFFACD', '#C3B1E1', '#DCD0FF'];
            const types = ['rose', 'tulip', 'carnation'];

            // DENSE: Spacing 15px
            for(let i=0; i<window.innerWidth; i+=15) {
                const depthY = Math.random() * 60; 
                flowers.push(new Flower(
                    i + Math.random()*10, 
                    canvas.height + depthY, 
                    types[Math.floor(Math.random()*types.length)], 
                    colors[Math.floor(Math.random()*colors.length)]
                ));
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                flowers.forEach(f => f.update());
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
