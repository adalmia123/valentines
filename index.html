<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Indie+Flower&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #ffe6ea;
            --env-color: #ff5c8a;      
            --env-dark: #d6336c;       
            --env-flap-dark: #ff4075; 
            --env-inside: #880e4f;     
            --paper-color: #fffbf0;    
            --paper-line: #e6d2b5;     
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            overflow: hidden; 
            overscroll-behavior: none;
        }

        /* --- ENVELOPE CONTAINER --- */
        .container {
            position: relative;
            width: 400px;
            height: 260px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s ease;
        }

        /* Only hover scale if not open */
        .container:not(.open):hover { transform: scale(1.02); }

        .envelope { position: relative; width: 100%; height: 100%; }

        .back {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--env-inside);
            border-radius: 0 0 10px 10px; z-index: 1;
        }

        /* LETTER - INITIAL STATE (Small & Inside) */
        .letter {
            position: absolute; 
            bottom: 0; 
            left: 5%; 
            width: 90%; 
            height: 90%; 
            background: var(--paper-color); 
            border: 1px solid var(--paper-line);
            z-index: 2; 
            padding: 20px; 
            box-sizing: border-box;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            
            /* Prepare for the transition */
            transform-origin: center center;
            transition: all 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* LETTER - GROWN STATE (Added via JS) */
        .letter.grown {
            /* Position fixed is applied inline by JS to handle coordinates */
            z-index: 2000 !important;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border-radius: 10px;
        }

        .pocket {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 3; pointer-events: none; 
        }

        .flap { position: absolute; }
        .flap.left { top: 0; left: 0; border-top: 130px solid transparent; border-bottom: 130px solid transparent; border-left: 240px solid var(--env-color); }
        .flap.right { top: 0; right: 0; border-top: 130px solid transparent; border-bottom: 130px solid transparent; border-right: 240px solid var(--env-color); }
        .flap.bottom { bottom: 0; left: 0; border-left: 200px solid transparent; border-right: 200px solid transparent; border-bottom: 145px solid var(--env-dark); border-radius: 0 0 10px 10px; }

        .lid {
            position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 200px solid transparent; border-right: 200px solid transparent; 
            border-top: 140px solid var(--env-flap-dark); 
            transform-origin: top; transition: transform 0.6s ease-in-out; z-index: 4; 
        }

        .open .lid { transform: rotateX(180deg); z-index: 0; }

        /* HINT TEXT */
        .hint-text {
            position: absolute;
            font-family: 'Indie Flower', cursive;
            color: #d6336c; font-size: 1.2rem; pointer-events: none;
            animation: pulseText 1.5s infinite alternate; white-space: nowrap; z-index: 20;
        }
        .hint-1 { top: -60px; left: -40px; transform: rotate(-15deg); }
        .hint-2 { bottom: -50px; right: -30px; transform: rotate(10deg); }
        @keyframes pulseText { from { transform: scale(1) rotate(var(--r)); opacity: 0.8; } to { transform: scale(1.1) rotate(var(--r)); opacity: 1; } }

        /* LETTER CONTENT STYLING */
        .letter-content {
            opacity: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease 0.5s; /* Delay fade in until grown */
        }
        .letter.grown .letter-content { opacity: 1; }

        .letter h2 {
            font-family: 'Dancing Script', cursive; color: #d32f2f; font-size: 2rem; margin: 0 0 15px 0;
        }
        .letter p {
            font-family: 'Indie Flower', cursive; font-size: 1.15rem; color: #444; margin: 0 0 12px 0; line-height: 1.3; font-weight: 600;
        }
        
        /* Highlight Classes */
        .highlight { font-weight: bold; padding: 0 4px; border-radius: 4px; }
        .h-amazing { color: #e63946; background: #ffe5ec; }
        .h-beautiful { color: #fb5607; background: #fff0db; }
        .h-cute { color: #ff006e; background: #ffe3fa; }
        .h-kind { color: #8338ec; background: #f2e6ff; }
        .h-smart { color: #3a86ff; background: #e0edff; }
        .h-baddie { color: #ffbe0b; background: #fffde0; }

        /* Buttons */
        .btn-group { margin-top: 15px; display: flex; gap: 15px; justify-content: center; width: 100%; position: relative; }
        button {
            padding: 10px 30px; font-family: 'Poppins', sans-serif; font-weight: bold; font-size: 14px;
            border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease; -webkit-tap-highlight-color: transparent;
        }
        #yesBtn { background-color: #ff4d6d; color: white; }
        #noBtn { background-color: #e0e0e0; color: #333; position: relative; transition: top 0.4s ease, left 0.4s ease; }
        
        /* CELEBRATION */
        #celebration {
            display: none; width: 100%; height: 100vh; position: fixed; top: 0; left: 0;
            background-color: var(--bg-color); z-index: 100; overflow: hidden; 
        }
        .header-area {
            position: absolute; top: 15px; width: 100%; text-align: center; z-index: 20;
            display: flex; justify-content: center; align-items: center; gap: 15px;
        }
        .text-container { display: flex; flex-direction: column; align-items: center; }
        .header-area h1 { font-family: 'Dancing Script', cursive; font-size: 3.5rem; color: #c92a42; margin: 0; text-shadow: 2px 2px 4px white; }
        .header-area h2 { font-family: 'Poppins', sans-serif; font-size: 1rem; color: #666; margin-top: 5px; background: rgba(255,255,255,0.6); padding: 5px 15px; border-radius: 20px; }

        .pulsing-heart {
            width: 40px; height: 40px; background-color: #ff4d6d;
            transform: rotate(-45deg); animation: pulse 1s infinite alternate; position: relative;
        }
        .pulsing-heart::before, .pulsing-heart::after {
            content: ""; position: absolute; width: 40px; height: 40px;
            background-color: #ff4d6d; border-radius: 50%;
        }
        .pulsing-heart::before { top: -20px; left: 0; }
        .pulsing-heart::after { left: 20px; top: 0; }
        @keyframes pulse { from { transform: rotate(-45deg) scale(1); } to { transform: rotate(-45deg) scale(1.2); } }

        .carousel-container {
            position: absolute; top: 140px; width: 100%; height: 350px;
            overflow-x: auto; overflow-y: hidden; z-index: 30;
            scrollbar-width: thin; scrollbar-color: rgba(255,100,100,0.3) transparent; scroll-behavior: smooth;
        }
        .carousel-track {
            display: grid; grid-template-rows: repeat(2, 1fr); grid-auto-flow: column; 
            gap: 15px; padding: 10px 40px; height: 100%; box-sizing: border-box;
        }
        .note-card {
            width: 200px; height: 140px; background: rgba(255, 255, 255, 0.85); border: 1px solid white;
            border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center; padding: 10px;
            font-family: 'Indie Flower', cursive; font-size: 1.1rem; color: #444; text-align: center;
            transition: transform 0.3s; cursor: pointer;
        }
        .note-card:hover { transform: scale(1.05); z-index: 40; background: white;}

        #garden { position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; z-index: 10; pointer-events: none; }

        /* MOBILE TWEAKS */
        @media (max-width: 600px) {
            .container { transform: scale(0.85); margin-top: 60px; }
            .hint-text { font-size: 1rem; }
            
            .header-area h1 { font-size: 2.5rem; }
            .pulsing-heart { width: 30px; height: 30px; }
            .pulsing-heart::before, .pulsing-heart::after { width: 30px; height: 30px; }
            .pulsing-heart::before { top: -15px; } .pulsing-heart::after { left: 15px; }
            
            .carousel-container { top: 130px; height: 300px; }
            .note-card { width: 150px; height: 120px; font-size: 0.95rem; }
        }

        .css-heart-fly {
            position: absolute; width: 30px; height: 30px; transform: rotate(-45deg); pointer-events: none; z-index: 50; opacity: 0; 
        }
        .css-heart-fly::before, .css-heart-fly::after {
            content: ""; position: absolute; width: 30px; height: 30px; border-radius: 50%; background-color: inherit; 
        }
        .css-heart-fly::before { top: -15px; left: 0; }
        .css-heart-fly::after { left: 15px; top: 0; }

        @keyframes floatUp { 0% { transform: translateY(0) rotate(-45deg) scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: translateY(-400px) rotate(-45deg) scale(1.2); opacity: 0; } }
        @keyframes rainDown { 0% { transform: translateY(-10vh) rotate(-45deg) translateX(0); opacity: 1; } 50% { transform: translateY(50vh) rotate(-35deg) translateX(20px); } 100% { transform: translateY(110vh) rotate(-45deg) translateX(-20px); opacity: 0; } }
    </style>
</head>
<body>

    <div class="container" id="container" onclick="openEnvelope()">
        <div class="hint-text hint-1" style="--r: -15deg">Open me! ðŸ’Œ</div>
        <div class="hint-text hint-2" style="--r: 10deg">What's inside? ðŸ‘€</div>

        <div class="envelope">
            <div class="back"></div>
            
            <div class="letter" id="letter">
                <div class="letter-content">
                    <h2>To the love of my life,</h2>
                    
                    <p>You make my life so meaningful, and I'm the luckiest guy in the world to be yours.</p>
                    
                    <p>I love you wholeheartedly, and I can't wait for our life together and many more Valentines.</p>
                    
                    <p>You are my <span class="highlight h-amazing">amazing</span>, <span class="highlight h-beautiful">beautiful</span>, <span class="highlight h-cute">cute</span>, <span class="highlight h-kind">kind</span>, <span class="highlight h-smart">smart</span>, <span class="highlight h-baddie">baddie</span> princess, and I love you.</p>
                    
                    <h2>Will you be my Valentine?</h2>
                    <p style="font-size: 0.8rem; color: #888;">(P.S. I promise to buy you flowers!)</p>
                    
                    <div class="btn-group">
                        <button id="yesBtn" onclick="celebrate(event)">YES!</button>
                        <button id="noBtn" onmouseover="runAway(event)" ontouchstart="runAway(event)">No</button>
                    </div>
                </div>
            </div>

            <div class="pocket">
                <div class="flap left"></div>
                <div class="flap right"></div>
                <div class="flap bottom"></div>
            </div>
            <div class="lid"></div>
        </div>
    </div>

    <div id="celebration">
        <div class="header-area">
            <div class="pulsing-heart"></div>
            <div class="text-container">
                <h1>YAY! I Love You!</h1>
                <h2>Here are 100 reasons why:</h2>
            </div>
            <div class="pulsing-heart"></div>
        </div>
        
        <div class="carousel-container">
            <div class="carousel-track" id="carouselTrack"></div>
        </div>

        <canvas id="garden"></canvas>
    </div>

    <script>
        let isOpen = false;
        let canRunaway = false; 
        const container = document.getElementById('container');
        const letter = document.getElementById('letter');
        const noBtn = document.getElementById('noBtn');

        function openEnvelope() {
            if (!isOpen) {
                container.classList.add('open');
                isOpen = true;
                
                // Hide hints
                document.querySelectorAll('.hint-text').forEach(el => el.style.display = 'none');
                
                // 1. Get current position of the letter BEFORE we move it
                const rect = letter.getBoundingClientRect();
                
                // 2. Set it to fixed at that exact spot (so it doesn't jump visually)
                letter.style.position = 'fixed';
                letter.style.top = rect.top + 'px';
                letter.style.left = rect.left + 'px';
                letter.style.width = rect.width + 'px';
                letter.style.height = rect.height + 'px';
                letter.style.zIndex = 1000;
                
                // 3. Force reflow to ensure browser registers the start position
                void letter.offsetWidth;

                // 4. Animate to Center (Small -> Big)
                // We use setTimeout to allow the 'open' lid animation to start first
                setTimeout(() => {
                    letter.style.top = '50%';
                    letter.style.left = '50%';
                    letter.style.transform = 'translate(-50%, -50%)';
                    
                    // Responsive sizing for the "Grown" letter
                    if (window.innerWidth < 600) {
                        letter.style.width = '90vw';
                        letter.style.height = '65vh';
                    } else {
                        letter.style.width = '450px';
                        letter.style.height = '600px';
                    }
                    
                    letter.classList.add('grown');
                    canRunaway = true;
                }, 400); // Wait 0.4s for lid to flip a bit
                
                // Spawn hearts
                for(let i=0; i<15; i++){ setTimeout(() => spawnHeart(true), i * 150); }
            }
        }

        let hasRunAway = false;
        function runAway(e) {
            if(e.type === 'touchstart') e.preventDefault(); 
            e.stopPropagation();
            if (!canRunaway) return;
            
            if (!hasRunAway && noBtn.parentNode !== document.body) {
                const rect = noBtn.getBoundingClientRect();
                noBtn.style.left = rect.left + 'px';
                noBtn.style.top = rect.top + 'px';
                noBtn.style.position = 'fixed';
                noBtn.style.zIndex = '2000';
                document.body.appendChild(noBtn);
                hasRunAway = true;
            }

            const pad = 80;
            const winW = window.innerWidth;
            const winH = window.innerHeight;
            const btnW = noBtn.offsetWidth;
            const btnH = noBtn.offsetHeight;
            
            const newX = Math.random() * (winW - btnW - pad * 2) + pad;
            const newY = Math.random() * (winH - btnH - pad * 2) + pad;

            noBtn.style.left = newX + 'px'; 
            noBtn.style.top = newY + 'px'; 
        }

        function celebrate(e) {
            e.stopPropagation();
            document.body.style.backgroundColor = "#fce4ec"; 
            container.style.display = 'none';
            letter.style.display = 'none'; 
            if(noBtn) noBtn.style.display = 'none';
            
            const celeb = document.getElementById('celebration');
            celeb.style.display = 'block';
            
            generateReasons();
            setTimeout(initGarden, 100);
            setInterval(() => spawnHeart(false), 400); 
        }

        // --- 100 REASONS (Physical & Romantic) ---
        const myReasons = [
            "Reason 1: Your mesmerizing eyes that I get lost in.",
            "Reason 2: Your cute, squishy cheeks.",
            "Reason 3: Your beautiful smile.",
            "Reason 4: The way you smell so good.",
            "Reason 5: Your soft hands.",
            "Reason 6: Your warm hugs.",
            "Reason 7: The cute way your nose crinkles.",
            "Reason 8: Your stunning hair.",
            "Reason 9: Your adorable sleepy face.",
            "Reason 10: The sparkle in your eyes.",
            "Reason 11: Your gorgeous style.",
            "Reason 12: Your elegance.",
            "Reason 13: Your infectious laugh.",
            "Reason 14: Your gentle touch.",
            "Reason 15: Your radiant glow.",
            "Reason 16: Your ambition.",
            "Reason 17: How smart you are.",
            "Reason 18: Your kindness.",
            "Reason 19: You support my dreams.",
            "Reason 20: I feel safe with you.",
            "Reason 21: Our late-night talks.",
            "Reason 22: Our inside jokes.",
            "Reason 23: The way you dance.",
            "Reason 24: Your patience.",
            "Reason 25: You cheer me up.",
            "Reason 26: Your singing voice.",
            "Reason 27: The way you look at me.",
            "Reason 28: Doing nothing together.",
            "Reason 29: Your empathy.",
            "Reason 30: You're my best friend.",
            "Reason 31: You make me better.",
            "Reason 32: Your adventurous spirit.",
            "Reason 33: How thoughtful you are.",
            "Reason 34: You listen to me.",
            "Reason 35: Your honesty.",
            "Reason 36: Your hard work.",
            "Reason 37: Our memories.",
            "Reason 38: Our future.",
            "Reason 39: You respect me.",
            "Reason 40: Your perspective.",
            "Reason 41: Your comfort.",
            "Reason 42: You have my back.",
            "Reason 43: Your cute texts.",
            "Reason 44: Your excitement.",
            "Reason 45: You make life fun.",
            "Reason 46: Your confidence.",
            "Reason 47: Your strength.",
            "Reason 48: Your generosity.",
            "Reason 49: You chose me.",
            "Reason 50: You make me feel special.",
            "Reason 51: Your playfulness.",
            "Reason 52: Your understanding.",
            "Reason 53: Your loyalty.",
            "Reason 54: Your music taste.",
            "Reason 55: You inspire me.",
            "Reason 56: Your creativity.",
            "Reason 57: Saying my name.",
            "Reason 58: Remembering details.",
            "Reason 59: Your optimism.",
            "Reason 60: You calm me down.",
            "Reason 61: Your independence.",
            "Reason 62: I'm proud of you.",
            "Reason 63: You take care of yourself.",
            "Reason 64: Your vulnerability.",
            "Reason 65: Growing together.",
            "Reason 66: Your resilience.",
            "Reason 67: Prioritizing us.",
            "Reason 68: Your forgiveness.",
            "Reason 69: Your focus face.",
            "Reason 70: Your wisdom.",
            "Reason 71: Inclusivity.",
            "Reason 72: Your passion.",
            "Reason 73: Your trust.",
            "Reason 74: Your soul.",
            "Reason 75: Cuddling with you.",
            "Reason 76: Self-improvement.",
            "Reason 77: Spontaneity.",
            "Reason 78: Grace under pressure.",
            "Reason 79: Appreciation.",
            "Reason 80: Handwriting.",
            "Reason 81: Determination.",
            "Reason 82: Humor.",
            "Reason 83: Expression.",
            "Reason 84: Grounding me.",
            "Reason 85: Classiness.",
            "Reason 86: Surprises.",
            "Reason 87: Reliability.",
            "Reason 88: Cute sneezes.",
            "Reason 89: Family values.",
            "Reason 90: Encouragement.",
            "Reason 91: Bravery.",
            "Reason 92: Loving nature.",
            "Reason 93: Making time.",
            "Reason 94: Authenticity.",
            "Reason 95: Being my light.",
            "Reason 96: Curiosity.",
            "Reason 97: Protectiveness.",
            "Reason 98: Dreaming big.",
            "Reason 99: You are perfect.",
            "Reason 100: I love you more than words."
        ];
        
        const cardColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#FDFD96', '#FFFACD', '#C3B1E1'];

        function generateReasons() {
            const track = document.getElementById('carouselTrack');
            myReasons.forEach((reason) => {
                const card = document.createElement('div');
                card.classList.add('note-card');
                card.innerText = reason;
                const color = cardColors[Math.floor(Math.random() * cardColors.length)];
                card.style.borderTop = `5px solid ${color}`;
                track.appendChild(card);
            });
        }

        const heartColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#C3B1E1'];
        function spawnHeart(isBalloon) {
            const heart = document.createElement('div');
            heart.classList.add('css-heart-fly');
            heart.style.backgroundColor = heartColors[Math.floor(Math.random() * heartColors.length)];

            if (isBalloon) {
                container.appendChild(heart);
                heart.style.left = (Math.random() * 60 + 20) + '%';
                heart.style.top = '50%'; 
                heart.style.animationName = 'floatUp';
                heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
            } else {
                document.body.appendChild(heart);
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = '-10vh'; 
                heart.style.position = 'fixed';
                heart.style.animationName = 'rainDown';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
            }
            setTimeout(() => heart.remove(), 6000);
        }

        function initGarden() {
            const canvas = document.getElementById('garden');
            const ctx = canvas.getContext('2d');
            
            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight * 0.6; 
            }
            resize();
            window.addEventListener('resize', resize);

            const flowers = [];

            const ROSE_PALETTES = [
                { base: '#990000', mid: '#cc0000', tip: '#ff0000' }, 
                { base: '#881111', mid: '#aa2222', tip: '#d00000' }, 
                { base: '#c9184a', mid: '#ff4d6d', tip: '#ff758f' }, 
                { base: '#ffcccc', mid: '#ffe5ec', tip: '#ffffff' }, 
            ];
            const CARNATION_PALETTES = [
                { base: '#f8f9fa', mid: '#ffe5ec', tip: '#ff0a54' }, 
                { base: '#f8f9fa', mid: '#f3c4fb', tip: '#9d4edd' }, 
            ];
            const TULIP_PALETTES = [
                { base: '#7209b7', mid: '#b5179e', tip: '#f72585' }, 
                { base: '#d00000', mid: '#e85d04', tip: '#ffba08' }, 
            ];

            function drawComplexPetal(x, y, w, h, palette, angle, noise = 0) {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle);
                ctx.beginPath();
                if (noise > 0) {
                    ctx.moveTo(0, 0);
                    for(let i=0; i<=h; i+=3) {
                        let offset = Math.sin(i * 0.8) * noise; 
                        let width = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(-width/2 + offset, -i);
                    }
                    for(let i=h; i>=0; i-=3) {
                        let offset = Math.sin(i * 0.8) * noise;
                        let width = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(width/2 + offset, -i);
                    }
                } else {
                    ctx.moveTo(0, 0);
                    ctx.bezierCurveTo(-w, -h/2, -w/2, -h, 0, -h); 
                    ctx.bezierCurveTo(w/2, -h, w, -h/2, 0, 0);    
                }
                let grad = ctx.createLinearGradient(0, 0, 0, -h);
                grad.addColorStop(0, palette.base);
                grad.addColorStop(0.5, palette.mid);
                grad.addColorStop(1, palette.tip);
                ctx.fillStyle = grad;
                ctx.fill();
                ctx.restore();
            }

            function drawHeartHead(x, y, size) {
                ctx.save();
                ctx.translate(x, y);
                // 2.8x Size
                const s = size * 85; 
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(-s/2, -s/2, -s, s/3, 0, s);
                ctx.bezierCurveTo(s, s/3, s/2, -s/2, 0, 0);
                ctx.fillStyle = '#ff0000';
                ctx.shadowColor = '#ff4d6d';
                ctx.shadowBlur = 15;
                ctx.fill();
                ctx.restore();
            }

            class Flower {
                constructor(x, y, type) {
                    this.x = x; this.y = y; this.originalY = y;
                    this.height = 0; 
                    this.maxHeight = Math.random() * 150 + 200;
                    this.growSpeed = Math.random() * 2 + 1;
                    this.type = type; 
                    
                    if (type === 'heart') {
                        this.palette = {base:'red',mid:'red',tip:'red'};
                        this.maxHeight = 300; 
                    } else if (type === 'rose') this.palette = ROSE_PALETTES[Math.floor(Math.random() * ROSE_PALETTES.length)];
                    else if (type === 'carnation') this.palette = CARNATION_PALETTES[Math.floor(Math.random() * CARNATION_PALETTES.length)];
                    else this.palette = TULIP_PALETTES[Math.floor(Math.random() * TULIP_PALETTES.length)];

                    this.bloomed = false; this.bloomSize = 0; this.maxBloom = Math.random() * 0.5 + 0.6; 
                }

                draw() {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.originalY);
                    const curve = Math.sin(this.height * 0.05) * 5;
                    ctx.quadraticCurveTo(this.x + curve, this.originalY - this.height / 2, this.x, this.originalY - this.height);
                    ctx.strokeStyle = '#2d6a4f'; ctx.lineWidth = 4; ctx.stroke();

                    // Leaves every 80px
                    if (this.height > 50) {
                        for(let h=50; h<this.height; h+=80) {
                            const dir = (h % 160 === 0) ? 1 : -1;
                            drawComplexPetal(this.x, this.originalY - h, 20, 15, {base:'#2d6a4f',mid:'#40916c',tip:'#52b788'}, dir*1.5, 0);
                        }
                    }

                    if (this.bloomed) {
                        const headX = this.x; const headY = this.originalY - this.height; const s = this.bloomSize * 35;
                        
                        if (this.type === 'heart') {
                            drawHeartHead(headX, headY - 10, this.bloomSize);
                        } else if (this.type === 'rose') {
                            for(let i=0; i<8; i++) { drawComplexPetal(headX, headY, s, s, this.palette, (i * (Math.PI*2)/8), 0); }
                            for(let i=0; i<6; i++) { drawComplexPetal(headX, headY, s*0.7, s*0.8, this.palette, (i * (Math.PI*2)/6) + 0.5, 0); }
                            for(let i=0; i<4; i++) { drawComplexPetal(headX, headY, s*0.4, s*0.5, this.palette, (i * (Math.PI*2)/4), 0); }
                        } else if (this.type === 'carnation') {
                            for(let i=0; i<10; i++) { drawComplexPetal(headX, headY, s*0.9, s*1.3, this.palette, (i * (Math.PI*2)/10), 3); }
                            for(let i=0; i<7; i++) { drawComplexPetal(headX, headY, s*0.7, s*1.0, this.palette, (i * (Math.PI*2)/7) + 0.3, 3); }
                        } else if (this.type === 'tulip') {
                            drawComplexPetal(headX, headY, s, s*1.5, this.palette, -0.35, 0);
                            drawComplexPetal(headX, headY, s, s*1.5, this.palette, 0.35, 0);
                            drawComplexPetal(headX, headY, s*1.1, s*1.6, this.palette, 0, 0);
                        }
                    }
                }

                update() {
                    if (this.height < this.maxHeight) { this.height += this.growSpeed; } else { this.bloomed = true; }
                    if (this.bloomed && this.bloomSize < this.maxBloom) { this.bloomSize += 0.01; }
                    this.draw();
                }
            }

            const types = ['rose', 'tulip', 'carnation'];
            const screenCenter = window.innerWidth / 2;
            const gardenFlowers = [];
            let heartFlower = null;

            for(let i=0; i<window.innerWidth; i+=15) {
                const depthY = Math.random() * 60; 
                let type = types[Math.floor(Math.random()*types.length)];
                if (Math.abs(i - screenCenter) < 10 && !heartFlower) {
                    type = 'heart';
                    heartFlower = new Flower(i, canvas.height + 20, type);
                } else {
                    gardenFlowers.push(new Flower(i + Math.random()*10, canvas.height + depthY, type));
                }
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                gardenFlowers.forEach(f => f.update());
                if(heartFlower) heartFlower.update();
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
