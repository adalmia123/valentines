<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Caveat:wght@400;700&family=Indie+Flower&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #ffe6ea;
            --env-color: #ff5c8a;      
            --env-dark: #d6336c;       
            --env-inside: #880e4f;     
            --paper-color: #fffbf0;    
            --paper-line: #e6d2b5;     
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            overflow: hidden; 
        }

        /* --- PHASE 1: ENVELOPE --- */
        .container {
            position: relative;
            width: 400px;
            height: 260px;
            cursor: pointer;
            z-index: 10;
        }

        .container:hover { transform: scale(1.02); transition: transform 0.3s; }

        .envelope { position: relative; width: 100%; height: 100%; }

        .back {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--env-inside);
            border-radius: 0 0 10px 10px; z-index: 1;
        }

        .letter {
            position: absolute; bottom: 0; left: 5%; width: 90%; height: 90%;
            background: var(--paper-color); border: 1px solid var(--paper-line);
            z-index: 2; 
            transition: transform 0.6s ease-in-out, top 0.6s, left 0.6s, width 0.6s, height 0.6s, box-shadow 0.6s;
            padding: 30px; box-sizing: border-box;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .pocket {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 3; pointer-events: none; 
        }

        .flap { position: absolute; }
        .flap.left { top: 0; left: 0; border-top: 130px solid transparent; border-bottom: 130px solid transparent; border-left: 220px solid var(--env-color); }
        .flap.right { top: 0; right: 0; border-top: 130px solid transparent; border-bottom: 130px solid transparent; border-right: 220px solid var(--env-color); }
        .flap.bottom { bottom: 0; left: 0; border-left: 200px solid transparent; border-right: 200px solid transparent; border-bottom: 150px solid var(--env-dark); border-radius: 0 0 10px 10px; }

        .lid {
            position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 200px solid transparent; border-right: 200px solid transparent; border-top: 140px solid var(--env-color); 
            transform-origin: top; transition: transform 0.6s ease-in-out; z-index: 4; 
        }

        .letter h2 { font-family: 'Dancing Script', cursive; color: #d32f2f; font-size: 2.5rem; margin: 5px 0 15px 0; }
        .letter p { font-family: 'Caveat', cursive; font-size: 1.5rem; color: #444; margin: 5px 0; line-height: 1.2; }
        .letter-content { opacity: 0; transition: opacity 0.5s ease 0.5s; }

        /* Animation States */
        .open .lid { transform: rotateX(180deg); z-index: 0; }
        .open .letter { transform: translateY(-220px); z-index: 5; }
        
        .letter.full-mode {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(1.2) !important; 
            width: 400px; height: 500px; z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4); border-radius: 10px;
        }
        .letter.full-mode .letter-content { opacity: 1; }

        /* Buttons */
        .btn-group { margin-top: 40px; display: flex; gap: 20px; justify-content: center; }
        button {
            padding: 12px 35px; font-family: 'Poppins', sans-serif; font-weight: bold; font-size: 16px;
            border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease; 
        }
        #yesBtn { background-color: #ff4d6d; color: white; }
        
        /* The No Button */
        #noBtn { 
            background-color: #e0e0e0; 
            color: #333; 
            /* Start relative to sit next to Yes */
            position: relative; 
            /* Smoothly glide to new positions */
            transition: top 0.4s ease, left 0.4s ease; 
        }

        #yesBtn:hover { transform: scale(1.1); }

        /* --- PHASE 2: CELEBRATION LAYOUT --- */
        #celebration {
            display: none;
            width: 100%; height: 100vh;
            position: fixed; top: 0; left: 0;
            background-color: var(--bg-color);
            z-index: 100;
            overflow: hidden; /* No body scroll */
        }

        /* HEADER SECTION */
        .header-area {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            z-index: 20;
        }
        .header-area h1 {
            font-family: 'Dancing Script', cursive; font-size: 4rem; color: #c92a42;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8); margin: 0;
        }
        .header-area h2 {
            font-family: 'Poppins', sans-serif; font-size: 1.2rem; color: #666;
            margin-top: 5px; background: rgba(255,255,255,0.6); 
            display: inline-block; padding: 5px 15px; border-radius: 20px;
        }

        /* CAROUSEL (Top Half) */
        .carousel-container {
            position: absolute;
            top: 150px; /* Default desktop spacing */
            width: 100%;
            height: 400px;
            overflow-x: auto; 
            overflow-y: hidden;
            z-index: 30;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,100,100,0.3) transparent;
            scroll-behavior: smooth;
        }
        
        .carousel-track {
            display: grid;
            grid-template-rows: repeat(2, 1fr); 
            grid-auto-flow: column; 
            gap: 20px;
            padding: 10px 50px;
            height: 100%;
            box-sizing: border-box;
        }

        .note-card {
            width: 220px;
            height: 160px;
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            font-family: 'Indie Flower', cursive;
            font-size: 1.2rem;
            color: #444;
            text-align: center;
            transition: transform 0.3s;
            cursor: pointer;
        }
        .note-card:hover { transform: scale(1.05); z-index: 40; background: white;}

        /* GARDEN (Bottom Half) */
        #garden {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 50%;
            z-index: 10; 
            pointer-events: none;
        }

        /* --- MOBILE ADJUSTMENTS --- */
        @media (max-width: 600px) {
            .container { width: 90vw; height: 60vw; }
            .letter.full-mode { width: 90vw; height: 60vh; }
            .header-area h1 { font-size: 2.8rem; }
            .header-area h2 { font-size: 1rem; max-width: 90%; }
            .carousel-container { top: 180px; height: 320px; }
            .carousel-track { gap: 15px; padding: 10px 20px; }
            .note-card { width: 160px; height: 130px; font-size: 1rem; }
        }

        /* HEARTS */
        .css-heart {
            position: absolute; width: 30px; height: 30px;
            transform: rotate(-45deg); pointer-events: none; z-index: 50; opacity: 0; 
        }
        .css-heart::before, .css-heart::after {
            content: ""; position: absolute; width: 30px; height: 30px;
            border-radius: 50%; background-color: inherit; 
        }
        .css-heart::before { top: -15px; left: 0; }
        .css-heart::after { left: 15px; top: 0; }

        @keyframes floatUp { 
            0% { transform: translateY(0) rotate(-45deg) scale(0.5); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-400px) rotate(-45deg) scale(1.2); opacity: 0; }
        }
        @keyframes rainDown { 
            0% { transform: translateY(-10vh) rotate(-45deg) translateX(0); opacity: 1; }
            50% { transform: translateY(50vh) rotate(-35deg) translateX(20px); }
            100% { transform: translateY(110vh) rotate(-45deg) translateX(-20px); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="container" id="container" onclick="openEnvelope()">
        <div class="envelope">
            <div class="back"></div>
            <div class="letter" id="letter">
                <div class="letter-content">
                    <h2>My Dearest,</h2>
                    <p>I have a question...</p>
                    <p><strong>Will you be my Valentine?</strong></p>
                    <p style="font-size: 0.9rem; margin-top: 15px; color: #888;">(I promise to buy you flowers!)</p>
                    <div class="btn-group">
                        <button id="yesBtn" onclick="celebrate(event)">YES!</button>
                        <button id="noBtn" onmouseover="runAway(event)">No</button>
                    </div>
                </div>
            </div>
            <div class="pocket">
                <div class="flap left"></div>
                <div class="flap right"></div>
                <div class="flap bottom"></div>
            </div>
            <div class="lid"></div>
        </div>
    </div>

    <div id="celebration">
        <div class="header-area">
            <h1>YAY! I Love You! ❤️</h1>
            <h2>Here are 100 reasons why:</h2>
        </div>
        
        <div class="carousel-container">
            <div class="carousel-track" id="carouselTrack">
                </div>
        </div>

        <canvas id="garden"></canvas>
    </div>

    <script>
        let isOpen = false;
        let canRunaway = false; 
        const container = document.getElementById('container');
        const letter = document.getElementById('letter');
        const noBtn = document.getElementById('noBtn');

        // 1. ENVELOPE LOGIC
        function openEnvelope() {
            if (!isOpen) {
                container.classList.add('open');
                isOpen = true;
                
                for(let i=0; i<15; i++){ setTimeout(() => spawnHeart(true), i * 150); }

                setTimeout(() => {
                    letter.classList.add('full-mode');
                    canRunaway = true; 
                }, 800);
            }
        }

        // 2. SAFE RUNAWAY BUTTON (NO JUMP FIX)
        function runAway(e) {
            e.stopPropagation();
            if (!canRunaway) return;
            
            // 1. Freeze current position visually if not already fixed
            if (noBtn.style.position !== 'fixed') {
                const rect = noBtn.getBoundingClientRect();
                noBtn.style.left = rect.left + 'px';
                noBtn.style.top = rect.top + 'px';
                noBtn.style.position = 'fixed';
            }

            // 2. Calculate SAFE boundaries (100px padding from edges)
            const pad = 100;
            const winW = window.innerWidth;
            const winH = window.innerHeight;
            const btnW = noBtn.offsetWidth;
            const btnH = noBtn.offsetHeight;
            
            // Randomly pick a new spot strictly within bounds
            const newX = Math.random() * (winW - btnW - pad * 2) + pad;
            const newY = Math.random() * (winH - btnH - pad * 2) + pad;

            noBtn.style.left = newX + 'px'; 
            noBtn.style.top = newY + 'px'; 
            noBtn.style.zIndex = '2000';
            
            // Grow Yes Button
            const yesBtn = document.getElementById('yesBtn');
            let currentSize = parseFloat(window.getComputedStyle(yesBtn).fontSize);
            yesBtn.style.fontSize = (currentSize + 2) + 'px';
            yesBtn.style.padding = '15px 40px';
        }

        // 3. CELEBRATION
        function celebrate(e) {
            e.stopPropagation();
            document.body.style.backgroundColor = "#fce4ec"; 
            container.style.display = 'none';
            letter.style.display = 'none'; 
            
            const celeb = document.getElementById('celebration');
            celeb.style.display = 'block';
            
            generateReasons();
            setTimeout(initGarden, 100);
            setInterval(() => spawnHeart(false), 400); 
        }

        // 4. GENERATE NOTES CAROUSEL
        const myReasons = [
            "Your kindness", "The way you smell", "Your cooking", "Your ambition",
            "Our late night talks", "Your eyes", "How you support me", "Your hugs",
            "Inside jokes", "Your patience", "Your intelligence", "Your style",
            "Your laugh", "The way you dance", "Your voice"
        ];
        while (myReasons.length < 100) { myReasons.push("Reason #" + (myReasons.length + 1) + ": I love you!"); }
        
        const cardColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#FDFD96', '#FFFACD', '#C3B1E1'];

        function generateReasons() {
            const track = document.getElementById('carouselTrack');
            myReasons.forEach((reason) => {
                const card = document.createElement('div');
                card.classList.add('note-card');
                card.innerText = reason;
                const color = cardColors[Math.floor(Math.random() * cardColors.length)];
                card.style.borderTop = `5px solid ${color}`;
                track.appendChild(card);
            });
        }

        // 5. HEARTS
        const heartColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#C3B1E1'];
        function spawnHeart(isBalloon) {
            const heart = document.createElement('div');
            heart.classList.add('css-heart');
            heart.style.backgroundColor = heartColors[Math.floor(Math.random() * heartColors.length)];

            if (isBalloon) {
                container.appendChild(heart);
                heart.style.left = (Math.random() * 60 + 20) + '%';
                heart.style.top = '50%'; 
                heart.style.animationName = 'floatUp';
                heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
            } else {
                document.body.appendChild(heart);
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = '-10vh'; 
                heart.style.position = 'fixed';
                heart.style.animationName = 'rainDown';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
            }
            setTimeout(() => heart.remove(), 6000);
        }

        // ==========================================
        //  COMPLEX PROCEDURAL FLOWER ENGINE
        // ==========================================
        function initGarden() {
            const canvas = document.getElementById('garden');
            const ctx = canvas.getContext('2d');
            
            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight * 0.5; // Bottom 50%
            }
            resize();
            window.addEventListener('resize', resize);

            const flowers = [];

            // PALETTES
            const ROSE_PALETTES = [
                { base: '#990000', mid: '#cc0000', tip: '#ff0000' }, 
                { base: '#881111', mid: '#aa2222', tip: '#d00000' }, 
                { base: '#c9184a', mid: '#ff4d6d', tip: '#ff758f' }, 
                { base: '#ffcccc', mid: '#ffe5ec', tip: '#ffffff' }, 
            ];
            const CARNATION_PALETTES = [
                { base: '#f8f9fa', mid: '#ffe5ec', tip: '#ff0a54' }, 
                { base: '#f8f9fa', mid: '#f3c4fb', tip: '#9d4edd' }, 
            ];
            const TULIP_PALETTES = [
                { base: '#7209b7', mid: '#b5179e', tip: '#f72585' }, 
                { base: '#d00000', mid: '#e85d04', tip: '#ffba08' }, 
            ];

            function drawComplexPetal(x, y, w, h, palette, angle, noise = 0) {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle);
                ctx.beginPath();
                if (noise > 0) {
                    ctx.moveTo(0, 0);
                    for(let i=0; i<=h; i+=3) {
                        let offset = Math.sin(i * 0.8) * noise; 
                        let width = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(-width/2 + offset, -i);
                    }
                    for(let i=h; i>=0; i-=3) {
                        let offset = Math.sin(i * 0.8) * noise;
                        let width = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(width/2 + offset, -i);
                    }
                } else {
                    ctx.moveTo(0, 0);
                    ctx.bezierCurveTo(-w, -h/2, -w/2, -h, 0, -h); 
                    ctx.bezierCurveTo(w/2, -h, w, -h/2, 0, 0);    
                }
                let grad = ctx.createLinearGradient(0, 0, 0, -h);
                grad.addColorStop(0, palette.base);
                grad.addColorStop(0.5, palette.mid);
                grad.addColorStop(1, palette.tip);
                ctx.fillStyle = grad;
                ctx.fill();
                ctx.restore();
            }

            class Flower {
                constructor(x, y, type) {
                    this.x = x; this.y = y; this.originalY = y;
                    this.height = 0; 
                    this.maxHeight = Math.random() * 150 + 200;
                    this.growSpeed = Math.random() * 2 + 1;
                    this.type = type; 
                    
                    if (type === 'rose') this.palette = ROSE_PALETTES[Math.floor(Math.random() * ROSE_PALETTES.length)];
                    else if (type === 'carnation') this.palette = CARNATION_PALETTES[Math.floor(Math.random() * CARNATION_PALETTES.length)];
                    else this.palette = TULIP_PALETTES[Math.floor(Math.random() * TULIP_PALETTES.length)];

                    this.bloomed = false; this.bloomSize = 0; this.maxBloom = Math.random() * 0.5 + 0.6; 
                }

                draw() {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.originalY);
                    const curve = Math.sin(this.height * 0.05) * 5;
                    ctx.quadraticCurveTo(this.x + curve, this.originalY - this.height / 2, this.x, this.originalY - this.height);
                    ctx.strokeStyle = '#2d6a4f'; ctx.lineWidth = 4; ctx.stroke();

                    if(this.height > 60) { drawComplexPetal(this.x, this.originalY - 50, 20, 15, {base:'#2d6a4f',mid:'#40916c',tip:'#52b788'}, -1.5, 0); }
                    
                    if (this.bloomed) {
                        const headX = this.x; const headY = this.originalY - this.height; const s = this.bloomSize * 35;
                        if (this.type === 'rose') {
                            for(let i=0; i<8; i++) { drawComplexPetal(headX, headY, s, s, this.palette, (i * (Math.PI*2)/8), 0); }
                            for(let i=0; i<6; i++) { drawComplexPetal(headX, headY, s*0.7, s*0.8, this.palette, (i * (Math.PI*2)/6) + 0.5, 0); }
                            for(let i=0; i<4; i++) { drawComplexPetal(headX, headY, s*0.4, s*0.5, this.palette, (i * (Math.PI*2)/4), 0); }
                        } else if (this.type === 'carnation') {
                            for(let i=0; i<10; i++) { drawComplexPetal(headX, headY, s*0.9, s*1.3, this.palette, (i * (Math.PI*2)/10), 3); }
                            for(let i=0; i<7; i++) { drawComplexPetal(headX, headY, s*0.7, s*1.0, this.palette, (i * (Math.PI*2)/7) + 0.3, 3); }
                        } else if (this.type === 'tulip') {
                            drawComplexPetal(headX, headY, s, s*1.5, this.palette, -0.35, 0);
                            drawComplexPetal(headX, headY, s, s*1.5, this.palette, 0.35, 0);
                            drawComplexPetal(headX, headY, s*1.1, s*1.6, this.palette, 0, 0);
                        }
                    }
                }

                update() {
                    if (this.height < this.maxHeight) { this.height += this.growSpeed; } else { this.bloomed = true; }
                    if (this.bloomed && this.bloomSize < this.maxBloom) { this.bloomSize += 0.01; }
                    this.draw();
                }
            }

            const types = ['rose', 'tulip', 'carnation'];
            for(let i=0; i<window.innerWidth; i+=15) {
                const depthY = Math.random() * 60; 
                flowers.push(new Flower(i + Math.random()*10, canvas.height + depthY, types[Math.floor(Math.random()*types.length)]));
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                flowers.forEach(f => f.update());
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
