<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Caveat:wght@400;700&family=Indie+Flower&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* A slightly darker pink background helps the flowers blend better */
            --bg-color: #fce4ec; 
            --env-color: #ff5c8a;      
            --env-dark: #d6336c;       
            --env-inside: #880e4f;     
            --paper-color: #fffbf0;    
            --paper-line: #e6d2b5;     
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            overflow: hidden; 
        }

        /* --- ENVELOPE CONTAINER --- */
        .envelope-wrapper {
            position: relative;
            cursor: pointer;
            width: 400px;
            height: 260px;
            transition: transform 0.3s ease;
            z-index: 10;
        }

        .envelope-wrapper:hover { transform: scale(1.02); }

        /* 1. BACK PANEL */
        .envelope-back {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 100%;
            background-color: var(--env-inside);
            border-radius: 0 0 10px 10px;
            z-index: 1; 
        }

        /* 2. THE LETTER */
        .letter {
            position: absolute;
            bottom: 0; 
            left: 5%;
            width: 90%;
            height: 90%; 
            background-color: var(--paper-color);
            border: 1px solid var(--paper-line);
            z-index: 2; /* Sits BETWEEN Back and Flaps */
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1), height 0.8s ease, z-index 0.1s;
            padding: 25px; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 -5px 10px rgba(0,0,0,0.1);
        }

        .letter h2 {
            font-family: 'Dancing Script', cursive;
            color: #d32f2f;
            font-size: 2.5rem;
            margin: 5px 0 15px 0;
        }
        
        .letter p {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            color: #444;
            margin: 5px 0;
            line-height: 1.2;
        }

        .letter-content {
            opacity: 0;
            transition: opacity 0.5s ease 0.6s;
        }

        /* 3. FRONT FLAPS (The Pocket) */
        .flap {
            position: absolute;
            z-index: 3; /* COVERS LETTER */
        }

        .flap.left {
            top: 0; left: 0;
            border-top: 130px solid transparent;
            border-bottom: 130px solid transparent;
            border-left: 220px solid var(--env-color);
        }
        
        .flap.right {
            top: 0; right: 0;
            border-top: 130px solid transparent;
            border-bottom: 130px solid transparent;
            border-right: 220px solid var(--env-color);
        }

        .flap.bottom {
            bottom: 0; left: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-bottom: 150px solid var(--env-dark); 
            border-radius: 0 0 10px 10px;
        }

        /* 4. TOP LID */
        .flap.top {
            top: 0; left: 0;
            width: 0; height: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-top: 140px solid var(--env-color); 
            transform-origin: top;
            transition: transform 0.6s ease-in-out 0s, z-index 0.2s;
            z-index: 4; 
        }

        /* --- ANIMATION STATES --- */
        .open .flap.top {
            transform: rotateX(180deg);
            z-index: 0; 
        }

        .open .letter {
            transform: translateY(-220px); 
            height: 480px; 
            z-index: 5; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .open .letter-content { opacity: 1; }

        /* --- BUTTONS --- */
        .btn-group {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        button {
            padding: 10px 30px;
            font-family: 'Poppins', sans-serif;
            font-weight: bold;
            font-size: 14px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease; 
        }

        #yesBtn { background-color: #ff4d6d; color: white; }
        
        #noBtn { 
            background-color: #e0e0e0; 
            color: #333; 
            position: relative; 
            transition: top 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), left 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        #yesBtn:hover { transform: scale(1.1); }

        /* --- CELEBRATION PAGE --- */
        #celebration {
            display: none;
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0; left: 0;
            /* Background matches CSS blend mode */
            background-color: var(--bg-color); 
            z-index: 100;
            overflow-y: auto;
            text-align: center;
            padding-top: 50px;
        }

        #celebration h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem;
            color: #c92a42;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px white;
            position: relative;
            z-index: 10;
        }

        /* CANVAS FOR FLOWERS */
        #garden {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; 
            pointer-events: none;
        }

        /* NOTES GRID */
        .reasons-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 1000px;
            margin: 40px auto;
            padding-bottom: 100px;
            position: relative;
            z-index: 5;
        }

        .sticky-note {
            width: 180px;
            height: 180px;
            padding: 20px;
            font-family: 'Indie Flower', cursive;
            font-size: 1.2rem;
            color: #444;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transform: rotate(var(--rot));
            background: rgba(255, 255, 255, 0.95);
        }
        
        .sticky-note:hover { transform: scale(1.1) rotate(0deg) !important; z-index: 100; }

        /* --- CSS HEARTS --- */
        .css-heart {
            position: absolute;
            width: 30px;
            height: 30px;
            transform: rotate(-45deg);
            pointer-events: none;
            z-index: 20;
            opacity: 0; 
        }
        .css-heart::before, .css-heart::after {
            content: ""; position: absolute; width: 30px; height: 30px;
            border-radius: 50%; background-color: inherit; 
        }
        .css-heart::before { top: -15px; left: 0; }
        .css-heart::after { left: 15px; top: 0; }

        @keyframes floatUp { 
            0% { transform: translateY(0) rotate(-45deg) scale(0.5); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-400px) rotate(-45deg) scale(1.2); opacity: 0; }
        }
        @keyframes rainDown { 
            0% { transform: translateY(-10vh) rotate(-45deg) translateX(0); opacity: 1; }
            50% { transform: translateY(50vh) rotate(-35deg) translateX(20px); }
            100% { transform: translateY(110vh) rotate(-45deg) translateX(-20px); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="envelope-wrapper" id="envelopeWrapper" onclick="openEnvelope()">
        <div class="envelope-back"></div>
        <div class="letter">
            <div class="letter-content">
                <h2>My Dearest,</h2>
                <p>I have a question...</p>
                <p><strong>Will you be my Valentine?</strong></p>
                <p style="font-size: 0.9rem; margin-top: 15px; color: #888;">(I promise to buy you flowers!)</p>
                <div class="btn-group">
                    <button id="yesBtn" onclick="celebrate(event)">YES!</button>
                    <button id="noBtn" onmouseover="runAway(event)">No</button>
                </div>
            </div>
        </div>
        <div class="flap left"></div>
        <div class="flap right"></div>
        <div class="flap bottom"></div>
        <div class="flap top"></div>
    </div>

    <div id="celebration">
        <h1>YAY! I Love You! ❤️</h1>
        <canvas id="garden"></canvas>
        <div style="height: 50px;"></div>
        <h2 style="font-family: 'Poppins'; color: #555; background: rgba(255,255,255,0.7); display:inline-block; padding: 5px 15px; border-radius: 10px; position: relative; z-index: 5;">100 Reasons Why:</h2>
        <div class="reasons-grid" id="reasonsGrid"></div>
    </div>

    <script>
        let isOpen = false;
        let canRunaway = false; 
        const envelope = document.getElementById('envelopeWrapper');
        const noBtn = document.getElementById('noBtn');

        // 1. OPEN ENVELOPE
        function openEnvelope() {
            if (!isOpen) {
                envelope.classList.add('open');
                isOpen = true;
                for(let i=0; i<15; i++){ setTimeout(() => spawnHeart(true), i * 150); }
                setTimeout(() => { canRunaway = true; }, 800);
            }
        }

        // 2. RUNAWAY NO BUTTON
        function runAway(e) {
            e.stopPropagation();
            if (!canRunaway) return;
            const maxX = window.innerWidth - noBtn.offsetWidth - 50;
            const maxY = window.innerHeight - noBtn.offsetHeight - 50;
            noBtn.style.position = 'fixed';
            noBtn.style.left = Math.max(20, Math.random() * maxX) + 'px';
            noBtn.style.top = Math.max(20, Math.random() * maxY) + 'px';
            noBtn.style.zIndex = '1000';
            const yesBtn = document.getElementById('yesBtn');
            let currentSize = parseFloat(window.getComputedStyle(yesBtn).fontSize);
            yesBtn.style.fontSize = (currentSize + 2) + 'px';
            yesBtn.style.padding = '12px 35px';
        }

        // 3. CELEBRATION
        function celebrate(e) {
            e.stopPropagation();
            document.body.style.backgroundColor = "#fce4ec"; // Ensure bg match
            envelope.style.display = 'none';
            noBtn.style.display = 'none';
            
            const celeb = document.getElementById('celebration');
            celeb.style.display = 'block';
            
            generateReasons();
            
            // PRELOAD REAL IMAGES
            preloadFlowers();
            
            setInterval(() => spawnHeart(false), 400); 
        }

        // 4. DATA GENERATION
        const myReasons = [
            "Your kindness", "The way you smell", "Your cooking", "Your ambition",
            "Our late night talks", "Your eyes", "How you support me", "Your hugs",
            "Inside jokes", "Your patience", "Your intelligence", "Your style",
            "Your laugh", "The way you dance", "Your voice"
        ];
        while (myReasons.length < 100) { myReasons.push("Reason #" + (myReasons.length + 1) + ": I love you!"); }
        const noteColors = ['#ffadad', '#ffd6a5', '#fdffb6', '#caffbf', '#9bf6ff', '#a0c4ff', '#bdb2ff', '#ffc6ff', '#fffffc'];

        function generateReasons() {
            const grid = document.getElementById('reasonsGrid');
            myReasons.forEach((reason) => {
                const note = document.createElement('div');
                note.classList.add('sticky-note');
                note.innerText = reason;
                note.style.setProperty('--rot', (Math.random() * 10 - 5) + 'deg');
                note.style.backgroundColor = noteColors[Math.floor(Math.random() * noteColors.length)];
                grid.appendChild(note);
            });
        }

        // 5. HEART SPAWNER
        const heartColors = ['#ff4d6d', '#d90429', '#ef233c', '#ff758f', '#c9184a'];
        function spawnHeart(isBalloon) {
            const heart = document.createElement('div');
            heart.classList.add('css-heart');
            heart.style.backgroundColor = heartColors[Math.floor(Math.random() * heartColors.length)];

            if (isBalloon) {
                envelope.appendChild(heart);
                heart.style.left = (Math.random() * 60 + 20) + '%';
                heart.style.top = '50%'; 
                heart.style.animationName = 'floatUp';
                heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
            } else {
                document.body.appendChild(heart);
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = '-10vh'; 
                heart.style.position = 'fixed';
                heart.style.animationName = 'rainDown';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
            }
            setTimeout(() => heart.remove(), 6000);
        }

        // ==========================================
        //  REAL FLOWER ENGINE (With Mix-Blend-Mode Trick)
        // ==========================================
        
        // These are REAL photos on white backgrounds.
        // We use CSS 'multiply' blend mode to make the white disappear.
        const flowerAssets = {
            rose: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Rose_on_white_background.jpg/640px-Rose_on_white_background.jpg", 
            tulip: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Tulip_St_Pancras.jpg/437px-Tulip_St_Pancras.jpg", 
            carnation: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Carnation_white_background.jpg/640px-Carnation_white_background.jpg" 
        };

        const loadedImages = {};

        function preloadFlowers() {
            let loadedCount = 0;
            const types = Object.keys(flowerAssets);
            
            types.forEach(type => {
                const img = new Image();
                img.crossOrigin = "Anonymous"; // Important for canvas
                img.src = flowerAssets[type];
                img.onload = () => {
                    loadedImages[type] = img;
                    loadedCount++;
                    if(loadedCount === types.length) {
                        initGarden();
                    }
                };
            });
        }

        function initGarden() {
            const canvas = document.getElementById('garden');
            const ctx = canvas.getContext('2d');
            
            // Activate Blend Mode globally for the canvas
            // This makes white pixels transparent!
            ctx.globalCompositeOperation = 'multiply';

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            const flowers = [];
            
            class Flower {
                constructor(x, y, type) {
                    this.x = x; this.y = y; this.originalY = y;
                    this.height = 0; 
                    this.maxHeight = Math.random() * 200 + 200; // Stem height
                    this.growSpeed = Math.random() * 2 + 1;
                    this.type = type; 
                    this.bloomed = false; 
                    this.bloomScale = 0; 
                    this.maxBloomScale = Math.random() * 0.2 + 0.2; // Scale down the huge photos
                }

                draw() {
                    // Draw Green Stem (Normal mode)
                    ctx.globalCompositeOperation = 'source-over'; 
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.originalY);
                    const curve = Math.sin(this.height * 0.05) * 5;
                    ctx.quadraticCurveTo(this.x + curve, this.originalY - this.height / 2, this.x, this.originalY - this.height);
                    ctx.strokeStyle = '#386641'; 
                    ctx.lineWidth = 6; 
                    ctx.stroke();

                    // Draw Leaves
                    if(this.height > 60) {
                        ctx.beginPath();
                        ctx.fillStyle = '#6a994e';
                        ctx.ellipse(this.x - 10, this.originalY - 40, 15, 6, -0.6, 0, Math.PI*2);
                        ctx.fill();
                    }

                    // Draw Flower Head (Multiply mode for transparency)
                    if (this.bloomed) {
                        ctx.globalCompositeOperation = 'multiply'; 
                        const img = loadedImages[this.type];
                        if (img) {
                            const width = img.width * this.bloomScale;
                            const height = img.height * this.bloomScale;
                            const headX = this.x - width/2;
                            const headY = (this.originalY - this.height) - height/1.2;
                            
                            ctx.drawImage(img, headX, headY, width, height);
                        }
                    }
                }

                update() {
                    if (this.height < this.maxHeight) { this.height += this.growSpeed; } else { this.bloomed = true; }
                    if (this.bloomed && this.bloomScale < this.maxBloomScale) { this.bloomScale += 0.005; }
                    this.draw();
                }
            }

            const types = ['rose', 'tulip', 'carnation'];

            // Plant flowers across screen
            for(let i=0; i<window.innerWidth; i+=70) {
                const depthY = Math.random() * 50; 
                flowers.push(new Flower(
                    i + Math.random()*20, 
                    canvas.height + depthY, 
                    types[Math.floor(Math.random()*types.length)]
                ));
            }

            function animate() {
                // Clear canvas but keep blend mode in mind
                ctx.globalCompositeOperation = 'source-over';
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                flowers.forEach(f => f.update());
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
