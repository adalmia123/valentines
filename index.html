<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Indie+Flower&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #ffe6ea;
            --env-color: #ff5c8a;      
            --env-dark: #d6336c;       
            --env-flap-dark: #ff4075; 
            --env-inside: #880e4f;     
            --paper-color: #fffbf0;    
            --paper-line: #e6d2b5;     
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            overflow: hidden; 
            overscroll-behavior: none;
        }

        /* --- ENVELOPE CONTAINER --- */
        .container {
            position: relative;
            width: 400px;
            height: 260px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .container.hoverable:hover { transform: scale(1.02); }

        .envelope { position: relative; width: 100%; height: 100%; }

        .back {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--env-inside);
            border-radius: 0 0 10px 10px; z-index: 1;
        }

        /* THE LETTER */
        .letter {
            position: absolute; 
            bottom: 0; 
            left: 5%; 
            width: 90%; 
            height: 90%; 
            background: var(--paper-color); 
            border: 1px solid var(--paper-line);
            z-index: 2; 
            padding: 20px; 
            box-sizing: border-box;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            transform-origin: center top; /* Important for scaling */
        }

        /* PHASE 1: Sliding UP inside the envelope */
        .letter.sliding {
            transition: transform 0.6s ease-out;
            transform: translateY(-150px);
            z-index: 5;
        }

        /* PHASE 3: Zooming to Center */
        .letter.zooming {
            transition: 
                top 0.8s ease-in-out,
                left 0.8s ease-in-out,
                width 0.8s ease-in-out,
                height 0.8s ease-in-out,
                transform 0.8s ease-in-out;
            
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border-radius: 10px;
            z-index: 2000 !important;
        }

        .pocket {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 3; pointer-events: none; 
        }

        .flap { position: absolute; }
        .flap.left { top: 0; left: 0; border-top: 130px solid transparent; border-bottom: 130px solid transparent; border-left: 240px solid var(--env-color); }
        .flap.right { top: 0; right: 0; border-top: 130px solid transparent; border-bottom: 130px solid transparent; border-right: 240px solid var(--env-color); }
        .flap.bottom { bottom: 0; left: 0; border-left: 200px solid transparent; border-right: 200px solid transparent; border-bottom: 145px solid var(--env-dark); border-radius: 0 0 10px 10px; }

        .lid {
            position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 200px solid transparent; border-right: 200px solid transparent; 
            border-top: 140px solid var(--env-flap-dark); 
            transform-origin: top; transition: transform 0.6s ease-in-out; z-index: 4; 
        }

        .open .lid { transform: rotateX(180deg); z-index: 0; }

        .hint-text {
            position: absolute;
            font-family: 'Indie Flower', cursive;
            color: #d6336c; font-size: 1.2rem; pointer-events: none;
            animation: pulseText 1.5s infinite alternate; white-space: nowrap; z-index: 20;
        }
        .hint-1 { top: -60px; left: -40px; transform: rotate(-15deg); }
        .hint-2 { bottom: -50px; right: -30px; transform: rotate(10deg); }
        @keyframes pulseText { from { transform: scale(1) rotate(var(--r)); opacity: 0.8; } to { transform: scale(1.1) rotate(var(--r)); opacity: 1; } }

        /* LETTER CONTENT TEXT */
        .letter-content {
            opacity: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease 0.5s; 
        }
        .letter.zooming .letter-content { opacity: 1; }

        .letter h2 { font-family: 'Dancing Script', cursive; color: #d32f2f; font-size: 2rem; margin: 0 0 15px 0; }
        .letter p { font-family: 'Indie Flower', cursive; font-size: 1.15rem; color: #444; margin: 0 0 12px 0; line-height: 1.3; font-weight: 600; }
        
        .highlight { font-weight: bold; padding: 0 4px; border-radius: 4px; }
        .h-amazing { color: #e63946; background: #ffe5ec; }
        .h-beautiful { color: #fb5607; background: #fff0db; }
        .h-cute { color: #ff006e; background: #ffe3fa; }
        .h-kind { color: #8338ec; background: #f2e6ff; }
        .h-smart { color: #3a86ff; background: #e0edff; }
        .h-baddie { color: #ffbe0b; background: #fffde0; }

        .btn-group { margin-top: 15px; display: flex; gap: 15px; justify-content: center; width: 100%; position: relative; }
        button {
            padding: 10px 30px; font-family: 'Poppins', sans-serif; font-weight: bold; font-size: 14px;
            border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease; -webkit-tap-highlight-color: transparent;
        }
        #yesBtn { background-color: #ff4d6d; color: white; }
        #noBtn { background-color: #e0e0e0; color: #333; position: relative; transition: top 0.4s ease, left 0.4s ease; }
        #yesBtn:hover { transform: scale(1.1); }
        
        /* CELEBRATION */
        #celebration {
            display: none; width: 100%; height: 100vh; position: fixed; top: 0; left: 0;
            background-color: var(--bg-color); z-index: 100; overflow: hidden; 
        }
        .header-area {
            position: absolute; top: 15px; width: 100%; text-align: center; z-index: 20;
            display: flex; justify-content: center; align-items: center; gap: 15px;
        }
        .text-container { display: flex; flex-direction: column; align-items: center; }
        .header-area h1 { font-family: 'Dancing Script', cursive; font-size: 3.5rem; color: #c92a42; margin: 0; text-shadow: 2px 2px 4px white; }
        .header-area h2 { font-family: 'Poppins', sans-serif; font-size: 1rem; color: #666; margin-top: 5px; background: rgba(255,255,255,0.6); padding: 5px 15px; border-radius: 20px; }

        .pulsing-heart {
            width: 40px; height: 40px; background-color: #ff4d6d;
            transform: rotate(-45deg); animation: pulse 1s infinite alternate; position: relative;
        }
        .pulsing-heart::before, .pulsing-heart::after {
            content: ""; position: absolute; width: 40px; height: 40px;
            background-color: #ff4d6d; border-radius: 50%;
        }
        .pulsing-heart::before { top: -20px; left: 0; }
        .pulsing-heart::after { left: 20px; top: 0; }
        @keyframes pulse { from { transform: rotate(-45deg) scale(1); } to { transform: rotate(-45deg) scale(1.2); } }

        .carousel-container {
            position: absolute; top: 140px; width: 100%; height: 350px;
            overflow-x: auto; overflow-y: hidden; z-index: 30;
            scrollbar-width: thin; scrollbar-color: rgba(255,100,100,0.3) transparent; scroll-behavior: smooth;
        }
        .carousel-track {
            display: grid; grid-template-rows: repeat(2, 1fr); grid-auto-flow: column; 
            gap: 15px; padding: 10px 40px; height: 100%; box-sizing: border-box;
        }
        .note-card {
            width: 200px; height: 140px; 
            /* Note color will be set by JS via background-color */
            border: 2px solid rgba(255,255,255,0.6);
            border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center; padding: 15px;
            font-family: 'Indie Flower', cursive; font-size: 1.1rem; color: #444; text-align: center;
            transition: transform 0.3s; cursor: pointer;
        }
        .note-card:hover { transform: scale(1.05); z-index: 40; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        #garden { position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; z-index: 10; pointer-events: none; }

        /* MOBILE TWEAKS */
        @media (max-width: 600px) {
            .container { transform: scale(0.85); margin-top: 60px; }
            .hint-text { font-size: 1rem; }
            
            .letter.zooming { width: 90vw !important; height: 75vh !important; }
            .letter h2 { font-size: 1.8rem; margin-bottom: 10px;}
            .letter p { font-size: 1rem; margin-bottom: 10px; }
            
            .header-area h1 { font-size: 2.5rem; }
            .pulsing-heart { width: 30px; height: 30px; }
            .pulsing-heart::before, .pulsing-heart::after { width: 30px; height: 30px; }
            .pulsing-heart::before { top: -15px; } .pulsing-heart::after { left: 15px; }
            
            .carousel-container { top: 130px; height: 300px; }
            .note-card { width: 150px; height: 120px; font-size: 0.9rem; }
        }

        .css-heart-fly {
            position: absolute; width: 30px; height: 30px; transform: rotate(-45deg); pointer-events: none; z-index: 50; opacity: 0; 
        }
        .css-heart-fly::before, .css-heart-fly::after {
            content: ""; position: absolute; width: 30px; height: 30px; border-radius: 50%; background-color: inherit; 
        }
        .css-heart-fly::before { top: -15px; left: 0; }
        .css-heart-fly::after { left: 15px; top: 0; }

        @keyframes floatUp { 0% { transform: translateY(0) rotate(-45deg) scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: translateY(-400px) rotate(-45deg) scale(1.2); opacity: 0; } }
        @keyframes rainDown { 0% { transform: translateY(-10vh) rotate(-45deg) translateX(0); opacity: 1; } 50% { transform: translateY(50vh) rotate(-35deg) translateX(20px); } 100% { transform: translateY(110vh) rotate(-45deg) translateX(-20px); opacity: 0; } }
    </style>
</head>
<body>

    <div class="container hoverable" id="container" onclick="openEnvelope()">
        <div class="hint-text hint-1" style="--r: -15deg">Open me! ðŸ’Œ</div>
        <div class="hint-text hint-2" style="--r: 10deg">What's inside? ðŸ‘€</div>

        <div class="envelope">
            <div class="back"></div>
            
            <div class="letter" id="letter">
                <div class="letter-content">
                    <h2>To the love of my life,</h2>
                    
                    <p>You make my life so incredibly meaningful, and I truly believe I am the luckiest guy in the world just to be by your side.</p>
                    
                    <p>I love you wholeheartedly, and I can't wait for everything our future holdsâ€”building a life together and celebrating a million more Valentines.</p>
                    
                    <p>You are my <span class="highlight h-amazing">amazing</span>, <span class="highlight h-beautiful">beautiful</span>, <span class="highlight h-cute">cute</span>, <span class="highlight h-kind">kind</span>, <span class="highlight h-smart">smart</span>, <span class="highlight h-baddie">baddie</span> princess, and I love you.</p>
                    
                    <h2>Will you be my Valentine?</h2>
                    <p style="font-size: 0.8rem; color: #888;">(P.S. I promise to buy you flowers!)</p>
                    
                    <div class="btn-group">
                        <button id="yesBtn" onclick="celebrate(event)">YES!</button>
                        <button id="noBtn" onmouseover="runAway(event)" ontouchstart="runAway(event)">No</button>
                    </div>
                </div>
            </div>

            <div class="pocket">
                <div class="flap left"></div>
                <div class="flap right"></div>
                <div class="flap bottom"></div>
            </div>
            <div class="lid"></div>
        </div>
    </div>

    <div id="celebration">
        <div class="header-area">
            <div class="pulsing-heart"></div>
            <div class="text-container">
                <h1>YAY! I Love You!</h1>
                <h2>Here are 100 reasons why:</h2>
            </div>
            <div class="pulsing-heart"></div>
        </div>
        
        <div class="carousel-container">
            <div class="carousel-track" id="carouselTrack"></div>
        </div>

        <canvas id="garden"></canvas>
    </div>

    <script>
        let isOpen = false;
        let canRunaway = false; 
        const container = document.getElementById('container');
        const letter = document.getElementById('letter');
        const noBtn = document.getElementById('noBtn');

        function openEnvelope() {
            if (!isOpen) {
                container.classList.add('open');
                container.classList.remove('hoverable'); 
                isOpen = true;
                document.querySelectorAll('.hint-text').forEach(el => el.style.display = 'none');
                
                // PHASE 1: Slide UP (Inside Envelope)
                letter.classList.add('sliding');

                // PHASE 2 & 3: Detach and Zoom
                setTimeout(() => {
                    // Capture current position (where it slid to)
                    const rect = letter.getBoundingClientRect();
                    
                    // FREEZE: Set to fixed at exact current pixel coordinates
                    letter.style.position = 'fixed';
                    letter.style.top = rect.top + 'px';
                    letter.style.left = rect.left + 'px';
                    letter.style.width = rect.width + 'px';
                    letter.style.height = rect.height + 'px';
                    
                    // Remove the transform relative to envelope
                    letter.style.transform = 'none'; 
                    letter.classList.remove('sliding'); // Stop sliding class
                    
                    // Force Reflow (Crucial for browser to register the freeze)
                    void letter.offsetWidth; 

                    // PHASE 3: ANIMATE TO CENTER
                    letter.classList.add('zooming');
                    
                    // Set final centered coordinates
                    letter.style.top = '50%';
                    letter.style.left = '50%';
                    letter.style.transform = 'translate(-50%, -50%)';
                    
                    // Responsive Scaling
                    if (window.innerWidth < 600) {
                        letter.style.width = '90vw';
                        letter.style.height = '75vh';
                    } else {
                        letter.style.width = '450px';
                        letter.style.height = '620px';
                    }
                    
                    canRunaway = true;
                }, 600); // Wait for slide to finish
                
                for(let i=0; i<15; i++){ setTimeout(() => spawnHeart(true), i * 150); }
            }
        }

        let hasRunAway = false;
        function runAway(e) {
            if(e.type === 'touchstart') e.preventDefault(); 
            e.stopPropagation();
            if (!canRunaway) return;
            
            if (!hasRunAway && noBtn.parentNode !== document.body) {
                const rect = noBtn.getBoundingClientRect();
                noBtn.style.left = rect.left + 'px';
                noBtn.style.top = rect.top + 'px';
                noBtn.style.position = 'fixed';
                noBtn.style.zIndex = '2000';
                document.body.appendChild(noBtn);
                hasRunAway = true;
            }

            const pad = 80;
            const winW = window.innerWidth;
            const winH = window.innerHeight;
            const btnW = noBtn.offsetWidth;
            const btnH = noBtn.offsetHeight;
            
            const newX = Math.random() * (winW - btnW - pad * 2) + pad;
            const newY = Math.random() * (winH - btnH - pad * 2) + pad;

            noBtn.style.left = newX + 'px'; 
            noBtn.style.top = newY + 'px'; 
        }

        function celebrate(e) {
            e.stopPropagation();
            document.body.style.backgroundColor = "#fce4ec"; 
            container.style.display = 'none';
            letter.style.display = 'none'; 
            noBtn.style.display = 'none';
            
            const celeb = document.getElementById('celebration');
            celeb.style.display = 'block';
            
            generateReasons();
            setTimeout(initGarden, 100);
            setInterval(() => spawnHeart(false), 400); 
        }

        // --- 100 CUSTOM REASONS ---
        // Array contains raw HTML for highlighting
        const myReasons = [
            "Reason 1: You make me a <span class='highlight h-better'>better</span> person every single day.",
            "Reason 2: I get lost in your <span class='highlight h-smart'>mesmerizing</span> eyes.",
            "Reason 3: Those <span class='highlight h-cute'>cute</span>, squishy cheeks I love to pinch.",
            "Reason 4: That <span class='highlight h-beautiful'>beautiful</span> smile lights up my world.",
            "Reason 5: I love the way you <span class='highlight h-amazing'>smell</span>.",
            "Reason 6: Holding your <span class='highlight h-kind'>soft</span> hands fits perfectly.",
            "Reason 7: Melting into your <span class='highlight h-beautiful'>warm</span> hugs.",
            "Reason 8: Seeing your nose crinkle is the <span class='highlight h-cute'>cutest</span> thing.",
            "Reason 9: Playing with your <span class='highlight h-amazing'>stunning</span> hair.",
            "Reason 10: Waking up to your <span class='highlight h-cute'>adorable</span> sleepy face.",
            "Reason 11: The <span class='highlight h-beautiful'>sparkle</span> in your eyes when you laugh.",
            "Reason 12: Admiring your natural <span class='highlight h-baddie'>elegance</span>.",
            "Reason 13: Hearing your <span class='highlight h-amazing'>infectious</span> laugh makes my day.",
            "Reason 14: Feeling your <span class='highlight h-kind'>gentle</span> touch.",
            "Reason 15: Seeing your <span class='highlight h-beautiful'>radiant</span> glow.",
            "Reason 16: Your incredible <span class='highlight h-smart'>ambition</span> inspires me.",
            "Reason 17: How <span class='highlight h-smart'>smart</span> and sharp you are.",
            "Reason 18: Your boundless <span class='highlight h-kind'>kindness</span> to everyone.",
            "Reason 19: You always support my dreams.",
            "Reason 20: I feel safer when I'm with you.",
            "Reason 21: Our late-night talks about everything.",
            "Reason 22: Our silly inside jokes no one else gets.",
            "Reason 23: The <span class='highlight h-cute'>cute</span> way you dance when you're happy.",
            "Reason 24: Your patience with me is amazing.",
            "Reason 25: You know exactly how to cheer me up.",
            "Reason 26: Listening to your sweet voice.",
            "Reason 27: The way you look at me with love.",
            "Reason 28: We can do absolutely nothing and still have fun.",
            "Reason 29: Your deep empathy for others.",
            "Reason 30: You are truly my best friend.",
            "Reason 31: You challenge me to grow.",
            "Reason 32: Your adventurous spirit.",
            "Reason 33: How thoughtful you are with everything.",
            "Reason 34: You really listen when I speak.",
            "Reason 35: Your honesty helps us grow.",
            "Reason 36: Your hard work ethic is admirable.",
            "Reason 37: All the beautiful memories we've made.",
            "Reason 38: The amazing future I see with you.",
            "Reason 39: You respect my feelings and opinions.",
            "Reason 40: The way you say 'Pikachu' melts me.",
            "Reason 41: Listening to you sing on our calls.",
            "Reason 42: You actually laugh at my horrible jokes.",
            "Reason 43: Butterflies when you call me 'baby'.",
            "Reason 44: Feeling your warmth when we cuddle.",
            "Reason 45: How you appreciate every gift I give you.",
            "Reason 46: Watching you stand up for yourself and me.",
            "Reason 47: You never take any bullshit.",
            "Reason 48: Your incredible fashion sense amazes me.",
            "Reason 49: Hearing 'Baby dooorrr hehe' in your <span class='highlight h-cute'>cute</span> voice.",
            "Reason 50: Your resilience and refusal to give up.",
            "Reason 51: Your playful attitude keeps us young.",
            "Reason 52: Your understanding nature.",
            "Reason 53: Your unwavering loyalty.",
            "Reason 54: Your great music taste.",
            "Reason 55: You inspire me daily.",
            "Reason 56: Your creativity shines in everything.",
            "Reason 57: The way you say my name.",
            "Reason 58: You remember the small details.",
            "Reason 59: Your optimism lifts me up.",
            "Reason 60: You know how to calm my anxiety.",
            "Reason 61: Your independence is sexy.",
            "Reason 62: I'm so proud to call you mine.",
            "Reason 63: How well you take care of yourself.",
            "Reason 64: Your vulnerability makes us stronger.",
            "Reason 65: Watching how we grow together.",
            "Reason 66: Your resilience in hard times.",
            "Reason 67: You prioritize 'us'.",
            "Reason 68: Your ability to forgive.",
            "Reason 69: Your <span class='highlight h-cute'>cute</span> focus face.",
            "Reason 70: Your wisdom beyond your years.",
            "Reason 71: You make everyone feel included.",
            "Reason 72: Your passion for what you love.",
            "Reason 73: Your complete trust in me.",
            "Reason 74: Your beautiful soul shines through.",
            "Reason 75: Cuddling with you is my happy place.",
            "Reason 76: We learn new things together.",
            "Reason 77: Your spontaneity keeps life exciting.",
            "Reason 78: Your grace under pressure.",
            "Reason 79: You are so appreciative.",
            "Reason 80: Your beautiful handwriting.",
            "Reason 81: Your determination to succeed.",
            "Reason 82: Your unique sense of humor.",
            "Reason 83: How you express your feelings.",
            "Reason 84: You ground me when I'm stressed.",
            "Reason 85: Your classiness and poise.",
            "Reason 86: The way you surprise me.",
            "Reason 87: Your reliability.",
            "Reason 88: Your <span class='highlight h-cute'>cute</span> little sneezes.",
            "Reason 89: How much you care about family.",
            "Reason 90: Your constant encouragement.",
            "Reason 91: Your bravery in facing fears.",
            "Reason 92: Your appreciation for nature.",
            "Reason 93: You always make time for me.",
            "Reason 94: Your authenticity; you are real.",
            "Reason 95: You are my light in the dark.",
            "Reason 96: Your endless curiosity.",
            "Reason 97: You are protective of our love.",
            "Reason 98: You dream big and aim high.",
            "Reason 99: You are simply <span class='highlight h-amazing'>perfect</span> to me.",
            "Reason 100: I love you more than words can say."
        ];
        
        // Pastel colors for cards
        const cardColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#FDFD96', '#FFFACD', '#C3B1E1'];

        function generateReasons() {
            const track = document.getElementById('carouselTrack');
            myReasons.forEach((reason) => {
                const card = document.createElement('div');
                card.classList.add('note-card');
                
                // 1. Remove HTML tags for clean card text
                const cleanText = reason.replace(/<[^>]*>/g, '');
                card.innerText = cleanText;
                
                // 2. Apply Pastel Background
                const color = cardColors[Math.floor(Math.random() * cardColors.length)];
                card.style.backgroundColor = color;
                
                // 3. Optional: Make background slightly transparent for glass effect
                // card.style.background = `rgba(${hexToRgb(color)}, 0.8)`;
                
                track.appendChild(card);
            });
        }

        const heartColors = ['#FFB7C5', '#FFD1DC', '#AEC6CF', '#ADD8E6', '#C3B1E1'];
        function spawnHeart(isBalloon) {
            const heart = document.createElement('div');
            heart.classList.add('css-heart-fly');
            heart.style.backgroundColor = heartColors[Math.floor(Math.random() * heartColors.length)];

            if (isBalloon) {
                container.appendChild(heart);
                heart.style.left = (Math.random() * 60 + 20) + '%';
                heart.style.top = '50%'; 
                heart.style.animationName = 'floatUp';
                heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
            } else {
                document.body.appendChild(heart);
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = '-10vh'; 
                heart.style.position = 'fixed';
                heart.style.animationName = 'rainDown';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
            }
            setTimeout(() => heart.remove(), 6000);
        }

        function initGarden() {
            const canvas = document.getElementById('garden');
            const ctx = canvas.getContext('2d');
            
            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight * 0.6; 
            }
            resize();
            window.addEventListener('resize', resize);

            const flowers = [];

            const ROSE_PALETTES = [
                { base: '#990000', mid: '#cc0000', tip: '#ff0000' }, 
                { base: '#881111', mid: '#aa2222', tip: '#d00000' }, 
                { base: '#c9184a', mid: '#ff4d6d', tip: '#ff758f' }, 
                { base: '#ffcccc', mid: '#ffe5ec', tip: '#ffffff' }, 
            ];
            const CARNATION_PALETTES = [
                { base: '#f8f9fa', mid: '#ffe5ec', tip: '#ff0a54' }, 
                { base: '#f8f9fa', mid: '#f3c4fb', tip: '#9d4edd' }, 
            ];
            const TULIP_PALETTES = [
                { base: '#7209b7', mid: '#b5179e', tip: '#f72585' }, 
                { base: '#d00000', mid: '#e85d04', tip: '#ffba08' }, 
            ];

            function drawComplexPetal(x, y, w, h, palette, angle, noise = 0) {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle);
                ctx.beginPath();
                if (noise > 0) {
                    ctx.moveTo(0, 0);
                    for(let i=0; i<=h; i+=3) {
                        let offset = Math.sin(i * 0.8) * noise; 
                        let width = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(-width/2 + offset, -i);
                    }
                    for(let i=h; i>=0; i-=3) {
                        let offset = Math.sin(i * 0.8) * noise;
                        let width = Math.sin((i/h) * Math.PI) * w;
                        ctx.lineTo(width/2 + offset, -i);
                    }
                } else {
                    ctx.moveTo(0, 0);
                    ctx.bezierCurveTo(-w, -h/2, -w/2, -h, 0, -h); 
                    ctx.bezierCurveTo(w/2, -h, w, -h/2, 0, 0);    
                }
                let grad = ctx.createLinearGradient(0, 0, 0, -h);
                grad.addColorStop(0, palette.base);
                grad.addColorStop(0.5, palette.mid);
                grad.addColorStop(1, palette.tip);
                ctx.fillStyle = grad;
                ctx.fill();
                ctx.restore();
            }

            function drawHeartHead(x, y, size) {
                ctx.save();
                ctx.translate(x, y);
                // 2.8x Size
                const s = size * 85; 
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(-s/2, -s/2, -s, s/3, 0, s);
                ctx.bezierCurveTo(s, s/3, s/2, -s/2, 0, 0);
                ctx.fillStyle = '#ff0000';
                ctx.shadowColor = '#ff4d6d';
                ctx.shadowBlur = 15;
                ctx.fill();
                ctx.restore();
            }

            class Flower {
                constructor(x, y, type) {
                    this.x = x; this.y = y; this.originalY = y;
                    this.height = 0; 
                    this.maxHeight = Math.random() * 150 + 200;
                    this.growSpeed = Math.random() * 2 + 1;
                    this.type = type; 
                    
                    if (type === 'heart') {
                        this.palette = {base:'red',mid:'red',tip:'red'};
                        // REDUCED HEIGHT for Heart
                        this.maxHeight = canvas.height - 180; 
                    } else if (type === 'rose') this.palette = ROSE_PALETTES[Math.floor(Math.random() * ROSE_PALETTES.length)];
                    else if (type === 'carnation') this.palette = CARNATION_PALETTES[Math.floor(Math.random() * CARNATION_PALETTES.length)];
                    else this.palette = TULIP_PALETTES[Math.floor(Math.random() * TULIP_PALETTES.length)];

                    this.bloomed = false; this.bloomSize = 0; this.maxBloom = Math.random() * 0.5 + 0.6; 
                }

                draw() {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.originalY);
                    const curve = Math.sin(this.height * 0.05) * 5;
                    ctx.quadraticCurveTo(this.x + curve, this.originalY - this.height / 2, this.x, this.originalY - this.height);
                    ctx.strokeStyle = '#2d6a4f'; ctx.lineWidth = 4; ctx.stroke();

                    // Leaves with Variance
                    if (this.height > 50) {
                        for(let h=50; h<this.height; h+=80) {
                            const dir = (h % 160 === 0) ? 1 : -1;
                            const angleVariance = (Math.random() * 0.5) - 0.25; 
                            drawComplexPetal(this.x, this.originalY - h, 20, 15, {base:'#2d6a4f',mid:'#40916c',tip:'#52b788'}, (dir*1.5)+angleVariance, 0);
                        }
                    }

                    if (this.bloomed) {
                        const headX = this.x; const headY = this.originalY - this.height; const s = this.bloomSize * 35;
                        
                        if (this.type === 'heart') {
                            drawHeartHead(headX, headY - 10, this.bloomSize);
                        } else if (this.type === 'rose') {
                            for(let i=0; i<8; i++) { drawComplexPetal(headX, headY, s, s, this.palette, (i * (Math.PI*2)/8), 0); }
                            for(let i=0; i<6; i++) { drawComplexPetal(headX, headY, s*0.7, s*0.8, this.palette, (i * (Math.PI*2)/6) + 0.5, 0); }
                            for(let i=0; i<4; i++) { drawComplexPetal(headX, headY, s*0.4, s*0.5, this.palette, (i * (Math.PI*2)/4), 0); }
                        } else if (this.type === 'carnation') {
                            for(let i=0; i<10; i++) { drawComplexPetal(headX, headY, s*0.9, s*1.3, this.palette, (i * (Math.PI*2)/10), 3); }
                            for(let i=0; i<7; i++) { drawComplexPetal(headX, headY, s*0.7, s*1.0, this.palette, (i * (Math.PI*2)/7) + 0.3, 3); }
                        } else if (this.type === 'tulip') {
                            drawComplexPetal(headX, headY, s, s*1.5, this.palette, -0.35, 0);
                            drawComplexPetal(headX, headY, s, s*1.5, this.palette, 0.35, 0);
                            drawComplexPetal(headX, headY, s*1.1, s*1.6, this.palette, 0, 0);
                        }
                    }
                }

                update() {
                    if (this.height < this.maxHeight) { this.height += this.growSpeed; } else { this.bloomed = true; }
                    if (this.bloomed && this.bloomSize < this.maxBloom) { this.bloomSize += 0.01; }
                    this.draw();
                }
            }

            const types = ['rose', 'tulip', 'carnation'];
            const screenCenter = window.innerWidth / 2;
            const gardenFlowers = [];
            let heartFlower = null;

            for(let i=0; i<window.innerWidth; i+=15) {
                const depthY = Math.random() * 60; 
                let type = types[Math.floor(Math.random()*types.length)];
                if (Math.abs(i - screenCenter) < 10 && !heartFlower) {
                    type = 'heart';
                    heartFlower = new Flower(i, canvas.height + 20, type);
                } else {
                    gardenFlowers.push(new Flower(i + Math.random()*10, canvas.height + depthY, type));
                }
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                gardenFlowers.forEach(f => f.update());
                if(heartFlower) heartFlower.update();
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
