<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Caveat:wght@400;700&family=Indie+Flower&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #ffe6ea;
            --env-color: #ff5c8a;      /* Main outer color */
            --env-dark: #d6336c;       /* Darker shadow color */
            --env-inside: #bf214b;     /* Very dark inside pocket */
            --paper-color: #fffbf0;    /* Creamy white */
            --paper-line: #e6d2b5;     /* Subtle border */
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            overflow: hidden; 
        }

        /* --- ENVELOPE CONTAINER --- */
        .envelope-wrapper {
            position: relative;
            cursor: pointer;
            width: 350px; 
            height: 240px; 
            transition: transform 0.3s ease;
            z-index: 10;
        }

        .envelope-wrapper:hover {
            transform: scale(1.02);
        }

        /* 1. BACK OF ENVELOPE (Inside Pocket Color) */
        .envelope-back {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--env-inside);
            border-radius: 0 0 10px 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3); /* Inner shadow for depth */
            z-index: 1; 
        }

        /* 2. THE LETTER (Initially hidden inside) */
        .letter {
            position: absolute;
            bottom: 0; /* Starts at bottom of envelope */
            left: 5%;
            width: 90%;
            height: 95%; /* Fits inside */
            background-color: var(--paper-color);
            border: 2px solid var(--paper-line);
            z-index: 2; /* In front of Back, BEHIND Front Flaps */
            transition: transform 1s ease-in-out, z-index 0.1s;
            padding: 20px; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1); /* Top shadow */
        }

        .letter h2 {
            font-family: 'Dancing Script', cursive;
            color: #d32f2f;
            font-size: 2rem;
            margin: 5px 0;
        }
        
        .letter p {
            font-family: 'Caveat', cursive;
            font-size: 1.4rem;
            color: #444;
            margin: 5px 0;
            line-height: 1.1;
        }

        /* Hide content slightly until pulled out to avoid peeking */
        .letter-content {
            opacity: 0;
            transition: opacity 0.5s ease 0.5s;
        }

        /* 3. FRONT FLAPS (Side and Bottom) */
        .flap-front {
            position: absolute;
            width: 0;
            height: 0;
            z-index: 3; /* MUST be above letter */
        }

        .flap-left {
            top: 0; left: 0;
            border-top: 120px solid transparent;
            border-bottom: 120px solid transparent;
            border-left: 180px solid var(--env-color);
        }
        
        .flap-right {
            top: 0; right: 0;
            border-top: 120px solid transparent;
            border-bottom: 120px solid transparent;
            border-right: 180px solid var(--env-color);
        }

        .flap-bottom {
            bottom: 0; left: 0;
            border-left: 175px solid transparent;
            border-right: 175px solid transparent;
            border-bottom: 130px solid var(--env-dark); /* Darker for dimension */
            border-radius: 0 0 10px 10px;
        }

        /* 4. TOP FLAP (The Moving Lid) */
        .flap-top {
            position: absolute;
            top: 0; left: 0;
            width: 0; height: 0;
            border-left: 175px solid transparent;
            border-right: 175px solid transparent;
            border-top: 130px solid var(--env-color);
            transform-origin: top;
            transition: transform 0.6s ease-in-out 0s, z-index 0.2s; /* Open speed */
            z-index: 4; /* On top of everything */
        }

        /* --- ANIMATION STATES --- */
        
        /* Step 1: Open the lid */
        .open .flap-top {
            transform: rotateX(180deg);
            z-index: 1; /* Move behind envelope back */
        }

        /* Step 2: Slide Letter Up */
        .open .letter {
            /* Move up by 150px (half out) */
            transform: translateY(-180px); 
            z-index: 5; /* Once out, it can sit on top if needed, or stay behind bottom flap */
            height: 380px; /* Expand height to fit more text */
        }
        
        .open .letter-content {
            opacity: 1;
        }

        /* --- BUTTONS --- */
        .btn-group {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        button {
            padding: 8px 25px;
            font-family: 'Poppins', sans-serif;
            font-weight: bold;
            font-size: 14px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        #yesBtn { background-color: #ff4d6d; color: white; }
        #noBtn { background-color: #e0e0e0; color: #333; position: relative; }
        #yesBtn:hover { transform: scale(1.1); }

        /* --- CELEBRATION PAGE --- */
        #celebration {
            display: none;
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0; left: 0;
            background: linear-gradient(180deg, #fff0f3 0%, #ffe6ea 100%);
            z-index: 100;
            overflow-y: auto;
            text-align: center;
            padding-top: 50px;
        }

        #celebration h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem;
            color: #c92a42;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px white;
        }

        /* CANVAS FOR FLOWERS */
        #garden {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; 
            pointer-events: none;
        }

        /* NOTES GRID */
        .reasons-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 1000px;
            margin: 40px auto;
            padding-bottom: 100px;
        }

        .sticky-note {
            width: 180px;
            height: 180px;
            padding: 20px;
            font-family: 'Indie Flower', cursive;
            font-size: 1.2rem;
            color: #444;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transform: rotate(var(--rot));
            background: rgba(255, 255, 255, 0.95);
        }
        
        .sticky-note:hover { transform: scale(1.1) rotate(0deg) !important; z-index: 100; }

        /* --- REALISTIC CSS HEARTS --- */
        .css-heart {
            position: absolute;
            width: 30px;
            height: 30px;
            transform: rotate(-45deg);
            pointer-events: none;
            z-index: 20;
            opacity: 0; 
        }
        .css-heart::before, .css-heart::after {
            content: ""; position: absolute; width: 30px; height: 30px;
            border-radius: 50%; background-color: inherit; 
        }
        .css-heart::before { top: -15px; left: 0; }
        .css-heart::after { left: 15px; top: 0; }

        @keyframes floatUp { 
            0% { transform: translateY(0) rotate(-45deg) scale(0.5); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-400px) rotate(-45deg) scale(1.2); opacity: 0; }
        }
        @keyframes rainDown { 
            0% { transform: translateY(-10vh) rotate(-45deg) translateX(0); opacity: 1; }
            50% { transform: translateY(50vh) rotate(-35deg) translateX(20px); }
            100% { transform: translateY(110vh) rotate(-45deg) translateX(-20px); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="envelope-wrapper" id="envelopeWrapper" onclick="openEnvelope()">
        
        <div class="envelope-back"></div>
        
        <div class="letter">
            <div class="letter-content">
                <h2>My Dearest,</h2>
                <p>I have a question...</p>
                <p><strong>Will you be my Valentine?</strong></p>
                <p style="font-size: 0.9rem; margin-top: 15px;">(I promise to buy you flowers!)</p>
                
                <div class="btn-group">
                    <button id="yesBtn" onclick="celebrate(event)">YES!</button>
                    <button id="noBtn" onmouseover="runAway(event)">No</button>
                </div>
            </div>
        </div>

        <div class="flap-front flap-left"></div>
        <div class="flap-front flap-right"></div>
        <div class="flap-front flap-bottom"></div>

        <div class="flap-top"></div>

    </div>

    <div id="celebration">
        <h1>YAY! I Love You! ❤️</h1>
        <canvas id="garden"></canvas>
        <h2 style="font-family: 'Poppins'; color: #555; background: rgba(255,255,255,0.7); display:inline-block; padding: 5px 15px; border-radius: 10px;">100 Reasons Why:</h2>
        <div class="reasons-grid" id="reasonsGrid"></div>
    </div>

    <script>
        let isOpen = false;
        let canRunaway = false; 
        const envelope = document.getElementById('envelopeWrapper');
        const noBtn = document.getElementById('noBtn');

        // 1. OPEN ENVELOPE LOGIC
        function openEnvelope() {
            if (!isOpen) {
                envelope.classList.add('open');
                isOpen = true;
                
                // Spawn Hearts
                for(let i=0; i<15; i++){
                    setTimeout(() => spawnHeart(true), i * 150);
                }

                // Wait for animation to finish before enabling runaway button
                setTimeout(() => {
                    canRunaway = true;
                }, 800);
            }
        }

        // 2. RUNAWAY NO BUTTON
        function runAway(e) {
            e.stopPropagation();
            if (!canRunaway) return;

            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const btnWidth = noBtn.offsetWidth;
            const btnHeight = noBtn.offsetHeight;
            
            // Calculate random pos
            const newX = Math.random() * (windowWidth - btnWidth - 50);
            const newY = Math.random() * (windowHeight - btnHeight - 50);

            noBtn.style.position = 'fixed';
            noBtn.style.left = Math.max(20, newX) + 'px';
            noBtn.style.top = Math.max(20, newY) + 'px';
            noBtn.style.zIndex = '1000';

            // Grow YES button
            const yesBtn = document.getElementById('yesBtn');
            const currentSize = parseFloat(window.getComputedStyle(yesBtn).fontSize);
            yesBtn.style.fontSize = (currentSize + 2) + 'px';
            yesBtn.style.padding = '10px 30px';
        }

        // 3. CELEBRATION
        function celebrate(e) {
            e.stopPropagation();
            
            envelope.style.display = 'none';
            noBtn.style.display = 'none';
            
            const celeb = document.getElementById('celebration');
            celeb.style.display = 'block';
            
            generateReasons();
            setTimeout(initGarden, 500); // Start flowers
            setInterval(() => spawnHeart(false), 400); // Start rain
        }

        // 4. DATA GENERATION
        const myReasons = [
            "Your kindness", "The way you smell", "Your cooking", "Your ambition",
            "Our late night talks", "Your eyes", "How you support me", "Your hugs",
            "Inside jokes", "Your patience", "Your intelligence", "Your style",
            "Your laugh", "The way you dance", "Your voice"
        ];
        while (myReasons.length < 100) { myReasons.push("Reason #" + (myReasons.length + 1) + ": I love you!"); }

        const noteColors = ['#ffadad', '#ffd6a5', '#fdffb6', '#caffbf', '#9bf6ff', '#a0c4ff', '#bdb2ff', '#ffc6ff', '#fffffc'];

        function generateReasons() {
            const grid = document.getElementById('reasonsGrid');
            myReasons.forEach((reason) => {
                const note = document.createElement('div');
                note.classList.add('sticky-note');
                note.innerText = reason;
                note.style.setProperty('--rot', (Math.random() * 10 - 5) + 'deg');
                note.style.backgroundColor = noteColors[Math.floor(Math.random() * noteColors.length)];
                grid.appendChild(note);
            });
        }

        // 5. HEART SPAWNER
        const heartColors = ['#ff4d6d', '#d90429', '#ef233c', '#ff758f', '#c9184a'];
        function spawnHeart(isBalloon) {
            const heart = document.createElement('div');
            heart.classList.add('css-heart');
            heart.style.backgroundColor = heartColors[Math.floor(Math.random() * heartColors.length)];

            if (isBalloon) {
                envelope.appendChild(heart);
                heart.style.left = (Math.random() * 60 + 20) + '%';
                heart.style.top = '50%'; 
                heart.style.animationName = 'floatUp';
                heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
            } else {
                document.body.appendChild(heart);
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = '-10vh'; 
                heart.style.position = 'fixed';
                heart.style.animationName = 'rainDown';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
            }
            setTimeout(() => heart.remove(), 6000);
        }

        // ==========================================
        //  CODE GARDEN (Flower Engine)
        // ==========================================
        function initGarden() {
            const canvas = document.getElementById('garden');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const flowers = [];
            
            class Flower {
                constructor(x, y, type, color) {
                    this.x = x; this.y = y; this.originalY = y;
                    this.height = 0; this.maxHeight = Math.random() * 100 + 150;
                    this.growSpeed = Math.random() * 1.5 + 0.5;
                    this.type = type; this.color = color;
                    this.bloomed = false; this.bloomSize = 0; this.maxBloom = Math.random() * 15 + 20;
                }
                draw() {
                    // Stem
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.originalY);
                    ctx.quadraticCurveTo(this.x + Math.sin(this.height/40)*10, this.originalY - this.height/2, this.x, this.originalY - this.height);
                    ctx.strokeStyle = '#2d6a4f'; ctx.lineWidth = 3; ctx.stroke();

                    // Leaves
                    if(this.height > 60) {
                        ctx.beginPath(); ctx.fillStyle = '#40916c';
                        ctx.ellipse(this.x - 10, this.originalY - 40, 15, 5, -0.5, 0, Math.PI*2);
                        ctx.fill();
                    }

                    // Bloom
                    if (this.bloomed) {
                        const headY = this.originalY - this.height;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        if (this.type === 'tulip') {
                            ctx.arc(this.x, headY, this.bloomSize, 0, Math.PI, false); ctx.fill();
                            ctx.beginPath(); ctx.moveTo(this.x - this.bloomSize, headY);
                            ctx.lineTo(this.x, headY - this.bloomSize); ctx.lineTo(this.x + this.bloomSize, headY); ctx.fill();
                        } else { // Rose/Carnation
                            ctx.arc(this.x, headY, this.bloomSize, 0, Math.PI*2); ctx.fill();
                        }
                    }
                }
                update() {
                    if (this.height < this.maxHeight) { this.height += this.growSpeed; } else { this.bloomed = true; }
                    if (this.bloomed && this.bloomSize < this.maxBloom) { this.bloomSize += 0.3; }
                    this.draw();
                }
            }

            const colors = ['#e63946', '#ff0a54', '#ff477e', '#ff7096', '#9d4edd'];
            for(let i=0; i<window.innerWidth; i+=50) {
                flowers.push(new Flower(i + Math.random()*30, canvas.height, Math.random() > 0.5 ? 'tulip' : 'rose', colors[Math.floor(Math.random()*colors.length)]));
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                flowers.forEach(f => f.update());
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
